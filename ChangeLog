Changes in version 0.1.2.12-rc - 2007-03-16
  o Major bugfixes:
    - Fix an infinite loop introduced in 0.1.2.7-alpha when we serve
      directory information requested inside Tor connections (i.e. via
      begin_dir cells). It only triggered when the same connection was
      serving other data at the same time. Reported by seeess.

  o Minor bugfixes:
    - When creating a circuit via the controller, send a 'launched'
      event when we're done, so we follow the spec better.


Changes in version 0.1.2.11-rc - 2007-03-15
  o Minor bugfixes (controller), reported by daejees:
    - Correct the control spec to match how the code actually responds
      to 'getinfo addr-mappings/*'.
    - The control spec described a GUARDS event, but the code
      implemented a GUARD event. Standardize on GUARD, but let people
      ask for GUARDS too.


Changes in version 0.1.2.10-rc - 2007-03-07
  o Major bugfixes (Windows):
    - Do not load the NT services library functions (which may not exist)
      just to detect if we're a service trying to shut down. Now we run
      on Win98 and friends again.

  o Minor bugfixes (other):
    - Clarify a couple of log messages.
    - Fix a misleading socks5 error number.


Changes in version 0.1.2.9-rc - 2007-03-02
  o Major bugfixes (Windows):
    - On MinGW, use "%I64u" to printf/scanf 64-bit integers, instead
      of the usual GCC "%llu". This prevents a bug when saving 64-bit
      int configuration values: the high-order 32 bits would get
      truncated. In particular, we were being bitten by the default
      MaxAdvertisedBandwidth of 128 TB turning into 0. (Fixes bug 400
      and maybe also bug 397.)

  o Minor bugfixes (performance):
    - Use OpenSSL's AES implementation on platforms where it's faster.
      This could save us as much as 10% CPU usage.

  o Minor bugfixes (server):
    - Do not rotate onion key immediately after setting it for the first
      time.

  o Minor bugfixes (directory authorities):
    - Stop letting hibernating or obsolete servers affect uptime and
      bandwidth cutoffs.
    - Stop listing hibernating servers in the v1 directory.

  o Minor bugfixes (hidden services):
    - Upload hidden service descriptors slightly less often, to reduce
      load on authorities.

  o Minor bugfixes (other):
    - Fix an assert that could trigger if a controller quickly set then
      cleared EntryNodes.  (Bug found by Udo van den Heuvel.)
    - On architectures where sizeof(int)>4, still clamp declarable bandwidth
      to INT32_MAX.
    - Fix a potential race condition in the rpm installer.  Found by
      Stefan Nordhausen.
    - Try to fix eventdns warnings once and for all: do not treat a dns rcode
      of 2 as indicating that the server is completely bad; it sometimes
      means that the server is just bad for the request in question. (may fix
      the last of bug 326.)
    - Disable encrypted directory connections when we don't have a server
      descriptor for the destination. We'll get this working again in
      the 0.2.0 branch.


Changes in version 0.1.2.8-beta - 2007-02-26
  o Major bugfixes (crashes):
    - Stop crashing when the controller asks us to resetconf more than
      one config option at once. (Vidalia 0.0.11 does this.)
    - Fix a crash that happened on Win98 when we're given command-line
      arguments: don't try to load NT service functions from advapi32.dll
      except when we need them. (Bug introduced in 0.1.2.7-alpha;
      resolves bug 389.)
    - Fix a longstanding obscure crash bug that could occur when
      we run out of DNS worker processes. (Resolves bug 390.)

  o Major bugfixes (hidden services):
    - Correctly detect whether hidden service descriptor downloads are
      in-progress. (Suggested by Karsten Loesing; fixes bug 399.)

  o Major bugfixes (accounting):
    - When we start during an accounting interval before it's time to wake
      up, remember to wake up at the correct time. (May fix bug 342.)

  o Minor bugfixes (controller):
    - Give the controller END_STREAM_REASON_DESTROY events _before_ we
      clear the corresponding on_circuit variable, and remember later
      that we don't need to send a redundant CLOSED event.  (Resolves part
      3 of bug 367.)
    - Report events where a resolve succeeded or where we got a socks
      protocol error correctly, rather than calling both of them
      "INTERNAL".
    - Change reported stream target addresses to IP consistently when
      we finally get the IP from an exit node.
    - Send log messages to the controller even if they happen to be very
      long.

  o Minor bugfixes (other):
    - Display correct results when reporting which versions are
      recommended, and how recommended they are. (Resolves bug 383.)
    - Improve our estimates for directory bandwidth to be less random:
      guess that an unrecognized directory will have the average bandwidth
      from all known directories, not that it will have the average
      bandwidth from those directories earlier than it on the list.
    - If we start a server with ClientOnly 1, then set ClientOnly to 0
      and hup, stop triggering an assert based on an empty onion_key.
    - On platforms with no working mmap() equivalent, don't warn the
      user when cached-routers doesn't exist.
    - Warn the user when mmap() [or its equivalent] fails for some reason
      other than file-not-found.
    - Don't warn the user when cached-routers.new doesn't exist: that's
      perfectly fine when starting up for the first time.
    - When EntryNodes are configured, rebuild the guard list to contain,
      in order: the EntryNodes that were guards before; the rest of the
      EntryNodes; the nodes that were guards before.
    - Mask out all signals in sub-threads; only the libevent signal
      handler should be processing them. This should prevent some crashes
      on some machines using pthreads. (Patch from coderman.)
    - Fix switched arguments on memset in the implementation of
      tor_munmap() for systems with no mmap() call.
    - When Tor receives a router descriptor that it asked for, but
      no longer wants (because it has received fresh networkstatuses
      in the meantime), do not warn the user.  Cache the descriptor if
      we're a cache; drop it if we aren't.
    - Make earlier entry guards _really_ get retried when the network
      comes back online.
    - On a malformed DNS reply, always give an error to the corresponding
      DNS request.
    - Build with recent libevents on platforms that do not define the
      nonstandard types "u_int8_t" and friends.

  o Minor features (controller):
    - Warn the user when an application uses the obsolete binary v0
      control protocol.  We're planning to remove support for it during
      the next development series, so it's good to give people some
      advance warning.
    - Add STREAM_BW events to report per-entry-stream bandwidth
      use. (Patch from Robert Hogan.)
    - Rate-limit SIGNEWNYM signals in response to controllers that
      impolitely generate them for every single stream. (Patch from
      mwenge; closes bug 394.)
    - Make REMAP stream events have a SOURCE (cache or exit), and
      make them generated in every case where we get a successful
      connected or resolved cell.

  o Minor bugfixes (performance):
    - Call router_have_min_dir_info half as often. (This is showing up in
      some profiles, but not others.)
    - When using GCC, make log_debug never get called at all, and its
      arguments never get evaluated, when no debug logs are configured.
      (This is showing up in some profiles, but not others.)

  o Minor features:
    - Remove some never-implemented options.  Mark PathlenCoinWeight as
      obsolete.
    - Implement proposal 106: Stop requiring clients to have well-formed
      certificates; stop checking nicknames in certificates. (Clients
      have certificates so that they can look like Tor servers, but in
      the future we might want to allow them to look like regular TLS
      clients instead. Nicknames in certificates serve no purpose other
      than making our protocol easier to recognize on the wire.)
    - Revise messages on handshake failure again to be even more clear about
      which are incoming connections and which are outgoing.
    - Discard any v1 directory info that's over 1 month old (for
      directories) or over 1 week old (for running-routers lists).
    - Do not warn when individual nodes in the configuration's EntryNodes,
      ExitNodes, etc are down: warn only when all possible nodes
      are down. (Fixes bug 348.)
    - Always remove expired routers and networkstatus docs before checking
      whether we have enough information to build circuits. (Fixes
      bug 373.)
    - Put a lower-bound on MaxAdvertisedBandwidth.


Changes in version 0.1.2.7-alpha - 2007-02-06
  o Major bugfixes (rate limiting):
    - Servers decline directory requests much more aggressively when
      they're low on bandwidth. Otherwise they end up queueing more and
      more directory responses, which can't be good for latency.
    - But never refuse directory requests from local addresses.
    - Fix a memory leak when sending a 503 response for a networkstatus
      request.
    - Be willing to read or write on local connections (e.g. controller
      connections) even when the global rate limiting buckets are empty.
    - If our system clock jumps back in time, don't publish a negative
      uptime in the descriptor. Also, don't let the global rate limiting
      buckets go absurdly negative.
    - Flush local controller connection buffers periodically as we're
      writing to them, so we avoid queueing 4+ megabytes of data before
      trying to flush.

  o Major bugfixes (NT services):
    - Install as NT_AUTHORITY\LocalService rather than as SYSTEM; add a
      command-line flag so that admins can override the default by saying
      "tor --service install --user "SomeUser"".  This will not affect
      existing installed services.  Also, warn the user that the service
      will look for its configuration file in the service user's
      %appdata% directory.  (We can't do the 'hardwire the user's appdata
      directory' trick any more, since we may not have read access to that
      directory.)

  o Major bugfixes (other):
    - Previously, we would cache up to 16 old networkstatus documents
      indefinitely, if they came from nontrusted authorities. Now we
      discard them if they are more than 10 days old.
    - Fix a crash bug in the presence of DNS hijacking (reported by Andrew
      Del Vecchio).
    - Detect and reject malformed DNS responses containing circular
      pointer loops.
    - If exits are rare enough that we're not marking exits as guards,
      ignore exit bandwidth when we're deciding the required bandwidth
      to become a guard.
    - When we're handling a directory connection tunneled over Tor,
      don't fill up internal memory buffers with all the data we want
      to tunnel; instead, only add it if the OR connection that will
      eventually receive it has some room for it. (This can lead to
      slowdowns in tunneled dir connections; a better solution will have
      to wait for 0.2.0.)

  o Minor bugfixes (dns):
    - Add some defensive programming to eventdns.c in an attempt to catch
      possible memory-stomping bugs.
    - Detect and reject DNS replies containing IPv4 or IPv6 records with
      an incorrect number of bytes. (Previously, we would ignore the
      extra bytes.)
    - Fix as-yet-unused reverse IPv6 lookup code so it sends nybbles
      in the correct order, and doesn't crash.
    - Free memory held in recently-completed DNS lookup attempts on exit.
      This was not a memory leak, but may have been hiding memory leaks.
    - Handle TTL values correctly on reverse DNS lookups.
    - Treat failure to parse resolv.conf as an error.

  o Minor bugfixes (other):
    - Fix crash with "tor --list-fingerprint" (reported by seeess).
    - When computing clock skew from directory HTTP headers, consider what
      time it was when we finished asking for the directory, not what
      time it is now.
    - Expire socks connections if they spend too long waiting for the
      handshake to finish. Previously we would let them sit around for
      days, if the connecting application didn't close them either.
    - And if the socks handshake hasn't started, don't send a
      "DNS resolve socks failed" handshake reply; just close it.
    - Stop using C functions that OpenBSD's linker doesn't like.
    - Don't launch requests for descriptors unless we have networkstatuses
      from at least half of the authorities.  This delays the first
      download slightly under pathological circumstances, but can prevent
      us from downloading a bunch of descriptors we don't need.
    - Do not log IPs with TLS failures for incoming TLS
      connections. (Fixes bug 382.)
    - If the user asks to use invalid exit nodes, be willing to use
      unstable ones.
    - Stop using the reserved ac_cv namespace in our configure script.
    - Call stat() slightly less often; use fstat() when possible.
    - Refactor the way we handle pending circuits when an OR connection
      completes or fails, in an attempt to fix a rare crash bug.
    - Only rewrite a conn's address based on X-Forwarded-For: headers
      if it's a parseable public IP address; and stop adding extra quotes
      to the resulting address.

  o Major features:
    - Weight directory requests by advertised bandwidth. Now we can
      let servers enable write limiting but still allow most clients to
      succeed at their directory requests. (We still ignore weights when
      choosing a directory authority; I hope this is a feature.)

  o Minor features:
    - Create a new file ReleaseNotes which was the old ChangeLog. The
      new ChangeLog file now includes the summaries for all development
      versions too.
    - Check for addresses with invalid characters at the exit as well
      as at the client, and warn less verbosely when they fail. You can
      override this by setting ServerDNSAllowNonRFC953Addresses to 1.
    - Adapt a patch from goodell to let the contrib/exitlist script
      take arguments rather than require direct editing.
    - Inform the server operator when we decide not to advertise a
      DirPort due to AccountingMax enabled or a low BandwidthRate. It
      was confusing Zax, so now we're hopefully more helpful.
    - Bring us one step closer to being able to establish an encrypted
      directory tunnel without knowing a descriptor first. Still not
      ready yet. As part of the change, now assume we can use a
      create_fast cell if we don't know anything about a router.
    - Allow exit nodes to use nameservers running on ports other than 53.
    - Servers now cache reverse DNS replies.
    - Add an --ignore-missing-torrc command-line option so that we can
      get the "use sensible defaults if the configuration file doesn't
      exist" behavior even when specifying a torrc location on the command
      line.

  o Minor features (controller):
    - Track reasons for OR connection failure; make these reasons
      available via the controller interface. (Patch from Mike Perry.)
    - Add a SOCKS_BAD_HOSTNAME client status event so controllers
      can learn when clients are sending malformed hostnames to Tor.
    - Clean up documentation for controller status events.
    - Add a REMAP status to stream events to note that a stream's
      address has changed because of a cached address or a MapAddress
      directive.


Changes in version 0.1.2.6-alpha - 2007-01-09
  o Major bugfixes:
    - Fix an assert error introduced in 0.1.2.5-alpha: if a single TLS
      connection handles more than 4 gigs in either direction, we crash.
    - Fix an assert error introduced in 0.1.2.5-alpha: if we're an
      advertised exit node, somebody might try to exit from us when
      we're bootstrapping and before we've built our descriptor yet.
      Refuse the connection rather than crashing.

  o Minor bugfixes:
    - Warn if we (as a server) find that we've resolved an address that we
      weren't planning to resolve.
    - Warn that using select() on any libevent version before 1.1 will be
      unnecessarily slow (even for select()).
    - Flush ERR-level controller status events just like we currently
      flush ERR-level log events, so that a Tor shutdown doesn't prevent
      the controller from learning about current events.

  o Minor features (more controller status events):
    - Implement EXTERNAL_ADDRESS server status event so controllers can
      learn when our address changes.
    - Implement BAD_SERVER_DESCRIPTOR server status event so controllers
      can learn when directories reject our descriptor.
    - Implement SOCKS_UNKNOWN_PROTOCOL client status event so controllers
      can learn when a client application is speaking a non-socks protocol
      to our SocksPort.
    - Implement DANGEROUS_SOCKS client status event so controllers
      can learn when a client application is leaking DNS addresses.
    - Implement BUG general status event so controllers can learn when
      Tor is unhappy about its internal invariants.
    - Implement CLOCK_SKEW general status event so controllers can learn
      when Tor thinks the system clock is set incorrectly.
    - Implement GOOD_SERVER_DESCRIPTOR and ACCEPTED_SERVER_DESCRIPTOR
      server status events so controllers can learn when their descriptors
      are accepted by a directory.
    - Implement CHECKING_REACHABILITY and REACHABILITY_{SUCCEEDED|FAILED}
      server status events so controllers can learn about Tor's progress in
      deciding whether it's reachable from the outside.
    - Implement BAD_LIBEVENT general status event so controllers can learn
      when we have a version/method combination in libevent that needs to
      be changed.
    - Implement NAMESERVER_STATUS, NAMESERVER_ALL_DOWN, DNS_HIJACKED,
      and DNS_USELESS server status events so controllers can learn
      about changes to DNS server status.

  o Minor features (directory):
    - Authorities no longer recommend exits as guards if this would shift
      too much load to the exit nodes.


Changes in version 0.1.2.5-alpha - 2007-01-06
  o Major features:
    - Enable write limiting as well as read limiting. Now we sacrifice
      capacity if we're pushing out lots of directory traffic, rather
      than overrunning the user's intended bandwidth limits.
    - Include TLS overhead when counting bandwidth usage; previously, we
      would count only the bytes sent over TLS, but not the bytes used
      to send them.
    - Support running the Tor service with a torrc not in the same
      directory as tor.exe and default to using the torrc located in
      the %appdata%\Tor\ of the user who installed the service. Patch
      from Matt Edman.
    - Servers now check for the case when common DNS requests are going to
      wildcarded addresses (i.e. all getting the same answer), and change
      their exit policy to reject *:* if it's happening.
    - Implement BEGIN_DIR cells, so we can connect to the directory
      server via TLS to do encrypted directory requests rather than
      plaintext. Enable via the TunnelDirConns and PreferTunneledDirConns
      config options if you like.

  o Minor features (config and docs):
    - Start using the state file to store bandwidth accounting data:
      the bw_accounting file is now obsolete. We'll keep generating it
      for a while for people who are still using 0.1.2.4-alpha.
    - Try to batch changes to the state file so that we do as few
      disk writes as possible while still storing important things in
      a timely fashion.
    - The state file and the bw_accounting file get saved less often when
      the AvoidDiskWrites config option is set.
    - Make PIDFile work on Windows (untested).
    - Add internal descriptions for a bunch of configuration options:
      accessible via controller interface and in comments in saved
      options files.
    - Reject *:563 (NNTPS) in the default exit policy. We already reject
      NNTP by default, so this seems like a sensible addition.
    - Clients now reject hostnames with invalid characters. This should
      avoid some inadvertent info leaks. Add an option
      AllowNonRFC953Hostnames to disable this behavior, in case somebody
      is running a private network with hosts called @, !, and #.
    - Add a maintainer script to tell us which options are missing
      documentation: "make check-docs".
    - Add a new address-spec.txt document to describe our special-case
      addresses: .exit, .onion, and .noconnnect.

  o Minor features (DNS):
    - Ongoing work on eventdns infrastructure: now it has dns server
      and ipv6 support. One day Tor will make use of it.
    - Add client-side caching for reverse DNS lookups.
    - Add support to tor-resolve tool for reverse lookups and SOCKS5.
    - When we change nameservers or IP addresses, reset and re-launch
      our tests for DNS hijacking.

  o Minor features (directory):
    - Authorities now specify server versions in networkstatus. This adds
      about 2% to the side of compressed networkstatus docs, and allows
      clients to tell which servers support BEGIN_DIR and which don't.
      The implementation is forward-compatible with a proposed future
      protocol version scheme not tied to Tor versions.
    - DirServer configuration lines now have an orport= option so
      clients can open encrypted tunnels to the authorities without
      having downloaded their descriptors yet. Enabled for moria1,
      moria2, tor26, and lefkada now in the default configuration.
    - Directory servers are more willing to send a 503 "busy" if they
      are near their write limit, especially for v1 directory requests.
      Now they can use their limited bandwidth for actual Tor traffic.
    - Clients track responses with status 503 from dirservers. After a
      dirserver has given us a 503, we try not to use it until an hour has
      gone by, or until we have no dirservers that haven't given us a 503.
    - When we get a 503 from a directory, and we're not a server, we don't
      count the failure against the total number of failures allowed
      for the thing we're trying to download.
    - Report X-Your-Address-Is correctly from tunneled directory
      connections; don't report X-Your-Address-Is when it's an internal
      address; and never believe reported remote addresses when they're
      internal.
    - Protect against an unlikely DoS attack on directory servers.
    - Add a BadDirectory flag to network status docs so that authorities
      can (eventually) tell clients about caches they believe to be
      broken.

  o Minor features (controller):
    - Have GETINFO dir/status/* work on hosts with DirPort disabled.
    - Reimplement GETINFO so that info/names stays in sync with the
      actual keys.
    - Implement "GETINFO fingerprint".
    - Implement "SETEVENTS GUARD" so controllers can get updates on
      entry guard status as it changes.

  o Minor features (clean up obsolete pieces):
    - Remove some options that have been deprecated since at least
      0.1.0.x: AccountingMaxKB, LogFile, DebugLogFile, LogLevel, and
      SysLog. Use AccountingMax instead of AccountingMaxKB, and use Log
      to set log options.
    - We no longer look for identity and onion keys in "identity.key" and
      "onion.key" -- these were replaced by secret_id_key and
      secret_onion_key in 0.0.8pre1.
    - We no longer require unrecognized directory entries to be
      preceded by "opt".

  o Major bugfixes (security):
    - Stop sending the HttpProxyAuthenticator string to directory
      servers when directory connections are tunnelled through Tor.
    - Clients no longer store bandwidth history in the state file.
    - Do not log introduction points for hidden services if SafeLogging
      is set.
    - When generating bandwidth history, round down to the nearest
      1k. When storing accounting data, round up to the nearest 1k.
    - When we're running as a server, remember when we last rotated onion
      keys, so that we will rotate keys once they're a week old even if
      we never stay up for a week ourselves.

  o Major bugfixes (other):
    - Fix a longstanding bug in eventdns that prevented the count of
      timed-out resolves from ever being reset. This bug caused us to
      give up on a nameserver the third time it timed out, and try it
      10 seconds later... and to give up on it every time it timed out
      after that.
    - Take out the '5 second' timeout from the connection retry
      schedule. Now the first connect attempt will wait a full 10
      seconds before switching to a new circuit. Perhaps this will help
      a lot. Based on observations from Mike Perry.
    - Fix a bug on the Windows implementation of tor_mmap_file() that
      would prevent the cached-routers file from ever loading. Reported
      by John Kimble.

  o Minor bugfixes:
    - Fix an assert failure when a directory authority sets
      AuthDirRejectUnlisted and then receives a descriptor from an
      unlisted router. Reported by seeess.
    - Avoid a double-free when parsing malformed DirServer lines.
    - Fix a bug when a BSD-style PF socket is first used. Patch from
      Fabian Keil.
    - Fix a bug in 0.1.2.2-alpha that prevented clients from asking
      to resolve an address at a given exit node even when they ask for
      it by name.
    - Servers no longer ever list themselves in their "family" line,
      even if configured to do so. This makes it easier to configure
      family lists conveniently.
    - When running as a server, don't fall back to 127.0.0.1 when no
      nameservers are configured in /etc/resolv.conf; instead, make the
      user fix resolv.conf or specify nameservers explicitly. (Resolves
      bug 363.)
    - Stop accepting certain malformed ports in configured exit policies.
    - Don't re-write the fingerprint file every restart, unless it has
      changed.
    - Stop warning when a single nameserver fails: only warn when _all_ of
      our nameservers have failed. Also, when we only have one nameserver,
      raise the threshold for deciding that the nameserver is dead.
    - Directory authorities now only decide that routers are reachable
      if their identity keys are as expected.
    - When the user uses bad syntax in the Log config line, stop
      suggesting other bad syntax as a replacement.
    - Correctly detect ipv6 DNS capability on OpenBSD.

  o Minor bugfixes (controller):
    - Report the circuit number correctly in STREAM CLOSED events. Bug
      reported by Mike Perry.
    - Do not report bizarre values for results of accounting GETINFOs
      when the last second's write or read exceeds the allotted bandwidth.
    - Report "unrecognized key" rather than an empty string when the
      controller tries to fetch a networkstatus that doesn't exist.


Changes in version 0.1.1.26 - 2006-12-14
  o Security bugfixes:
    - Stop sending the HttpProxyAuthenticator string to directory
      servers when directory connections are tunnelled through Tor.
    - Clients no longer store bandwidth history in the state file.
    - Do not log introduction points for hidden services if SafeLogging
      is set.

  o Minor bugfixes:
    - Fix an assert failure when a directory authority sets
      AuthDirRejectUnlisted and then receives a descriptor from an
      unlisted router (reported by seeess).


Changes in version 0.1.2.4-alpha - 2006-12-03
  o Major features:
    - Add support for using natd; this allows FreeBSDs earlier than
      5.1.2 to have ipfw send connections through Tor without using
      SOCKS. (Patch from Zajcev Evgeny with tweaks from tup.)

  o Minor features:
    - Make all connections to addresses of the form ".noconnect"
      immediately get closed. This lets application/controller combos
      successfully test whether they're talking to the same Tor by
      watching for STREAM events.
    - Make cross.sh cross-compilation script work even when autogen.sh
      hasn't been run. (Patch from Michael Mohr.)
    - Statistics dumped by -USR2 now include a breakdown of public key
      operations, for profiling.

  o Major bugfixes:
    - Fix a major leak when directory authorities parse their
      approved-routers list, a minor memory leak when we fail to pick
      an exit node, and a few rare leaks on errors.
    - Handle TransPort connections even when the server sends data before
      the client sends data. Previously, the connection would just hang
      until the client sent data. (Patch from tup based on patch from
      Zajcev Evgeny.)
    - Avoid assert failure when our cached-routers file is empty on
      startup.

  o Minor bugfixes:
    - Don't log spurious warnings when we see a circuit close reason we
      don't recognize; it's probably just from a newer version of Tor.
    - Have directory authorities allow larger amounts of drift in uptime
      without replacing the server descriptor: previously, a server that
      restarted every 30 minutes could have 48 "interesting" descriptors
      per day.
    - Start linking to the Tor specification and Tor reference manual
      correctly in the Windows installer.
    - Add Vidalia to the OS X uninstaller script, so when we uninstall
      Tor/Privoxy we also uninstall Vidalia.
    - Resume building on Irix64, and fix a lot of warnings from its
      MIPSpro C compiler.
    - Don't corrupt last_guessed_ip in router_new_address_suggestion()
      when we're running as a client.


Changes in version 0.1.1.25 - 2006-11-04
  o Major bugfixes:
    - When a client asks us to resolve (rather than connect to)
      an address, and we have a cached answer, give them the cached
      answer. Previously, we would give them no answer at all.
    - We were building exactly the wrong circuits when we predict
      hidden service requirements, meaning Tor would have to build all
      its circuits on demand.
    - If none of our live entry guards have a high uptime, but we
      require a guard with a high uptime, try adding a new guard before
      we give up on the requirement. This patch should make long-lived
      connections more stable on average.
    - When testing reachability of our DirPort, don't launch new
      tests when there's already one in progress -- unreachable
      servers were stacking up dozens of testing streams.

  o Security bugfixes:
    - When the user sends a NEWNYM signal, clear the client-side DNS
      cache too. Otherwise we continue to act on previous information.

  o Minor bugfixes:
    - Avoid a memory corruption bug when creating a hash table for
      the first time.
    - Avoid possibility of controller-triggered crash when misusing
      certain commands from a v0 controller on platforms that do not
      handle printf("%s",NULL) gracefully.
    - Avoid infinite loop on unexpected controller input.
    - Don't log spurious warnings when we see a circuit close reason we
      don't recognize; it's probably just from a newer version of Tor.
    - Add Vidalia to the OS X uninstaller script, so when we uninstall
      Tor/Privoxy we also uninstall Vidalia.


Changes in version 0.1.2.3-alpha - 2006-10-29
  o Minor features:
    - Prepare for servers to publish descriptors less often: never
      discard a descriptor simply for being too old until either it is
      recommended by no authorities, or until we get a better one for
      the same router. Make caches consider retaining old recommended
      routers for even longer.
    - If most authorities set a BadExit flag for a server, clients
      don't think of it as a general-purpose exit. Clients only consider
      authorities that advertise themselves as listing bad exits.
    - Directory servers now provide 'Pragma: no-cache' and 'Expires'
      headers for content, so that we can work better in the presence of
      caching HTTP proxies.
    - Allow authorities to list nodes as bad exits by fingerprint or by
      address.

  o Minor features, controller:
    - Add a REASON field to CIRC events; for backward compatibility, this
      field is sent only to controllers that have enabled the extended
      event format.  Also, add additional reason codes to explain why
      a given circuit has been destroyed or truncated. (Patches from
      Mike Perry)
    - Add a REMOTE_REASON field to extended CIRC events to tell the
      controller about why a remote OR told us to close a circuit.
    - Stream events also now have REASON and REMOTE_REASON fields,
      working much like those for circuit events.
    - There's now a GETINFO ns/... field so that controllers can ask Tor
      about the current status of a router.
    - A new event type "NS" to inform a controller when our opinion of
      a router's status has changed.
    - Add a GETINFO events/names and GETINFO features/names so controllers
      can tell which events and features are supported.
    - A new CLEARDNSCACHE signal to allow controllers to clear the
      client-side DNS cache without expiring circuits.

  o Security bugfixes:
    - When the user sends a NEWNYM signal, clear the client-side DNS
      cache too. Otherwise we continue to act on previous information.

  o Minor bugfixes:
    - Avoid sending junk to controllers or segfaulting when a controller
      uses EVENT_NEW_DESC with verbose nicknames.
    - Stop triggering asserts if the controller tries to extend hidden
      service circuits (reported by mwenge).
    - Avoid infinite loop on unexpected controller input.
    - When the controller does a "GETINFO network-status", tell it
      about even those routers whose descriptors are very old, and use
      long nicknames where appropriate.
    - Change NT service functions to be loaded on demand.  This lets us
      build with MinGW without breaking Tor for Windows 98 users.
    - Do DirPort reachability tests less often, since a single test
      chews through many circuits before giving up.
    - In the hidden service example in torrc.sample, stop recommending
      esoteric and discouraged hidden service options.
    - When stopping an NT service, wait up to 10 sec for it to actually
      stop.  (Patch from Matt Edman; resolves bug 295.)
    - Fix handling of verbose nicknames with ORCONN controller events:
      make them show up exactly when requested, rather than exactly when
      not requested.
    - When reporting verbose nicknames in entry_guards_getinfo(), avoid
      printing a duplicate "$" in the keys we send (reported by mwenge).
    - Correctly set maximum connection limit on Cygwin. (This time
      for sure!)
    - Try to detect Windows correctly when cross-compiling.
    - Detect the size of the routers file correctly even if it is
      corrupted (on systems without mmap) or not page-aligned (on systems
      with mmap). This bug was harmless.
    - Sometimes we didn't bother sending a RELAY_END cell when an attempt
      to open a stream fails; now we do in more cases. This should
      make clients able to find a good exit faster in some cases, since
      unhandleable requests will now get an error rather than timing out.
    - Resolve two memory leaks when rebuilding the on-disk router cache
      (reported by fookoowa).
    - Clean up minor code warnings suggested by the MIPSpro C compiler,
      and reported by some Centos users.
    - Controller signals now work on non-Unix platforms that don't define
      SIGUSR1 and SIGUSR2 the way we expect.
    - Patch from Michael Mohr to contrib/cross.sh, so it checks more
      values before failing, and always enables eventdns.
    - Libevent-1.2 exports, but does not define in its headers, strlcpy.
      Try to fix this in configure.in by checking for most functions
      before we check for libevent.


Changes in version 0.1.2.2-alpha - 2006-10-07
  o Major features:
    - Make our async eventdns library on-by-default for Tor servers,
      and plan to deprecate the separate dnsworker threads.
    - Add server-side support for "reverse" DNS lookups (using PTR
      records so clients can determine the canonical hostname for a given
      IPv4 address). Only supported by servers using eventdns; servers
      now announce in their descriptors whether they support eventdns.
    - Specify and implement client-side SOCKS5 interface for reverse DNS
      lookups (see doc/socks-extensions.txt).
    - Add a BEGIN_DIR relay cell type for an easier in-protocol way to
      connect to directory servers through Tor. Previously, clients needed
      to find Tor exits to make private connections to directory servers.
    - Avoid choosing Exit nodes for entry or middle hops when the
      total bandwidth available from non-Exit nodes is much higher than
      the total bandwidth available from Exit nodes.
    - Workaround for name servers (like Earthlink's) that hijack failing
      DNS requests and replace the no-such-server answer with a "helpful"
      redirect to an advertising-driven search portal. Also work around
      DNS hijackers who "helpfully" decline to hijack known-invalid
      RFC2606 addresses. Config option "ServerDNSDetectHijacking 0"
      lets you turn it off.
    - Send out a burst of long-range padding cells once we've established
      that we're reachable. Spread them over 4 circuits, so hopefully
      a few will be fast. This exercises our bandwidth and bootstraps
      us into the directory more quickly.

  o New/improved config options:
    - Add new config option "ResolvConf" to let the server operator
      choose an alternate resolve.conf file when using eventdns.
    - Add an "EnforceDistinctSubnets" option to control our "exclude
      servers on the same /16" behavior. It's still on by default; this
      is mostly for people who want to operate private test networks with
      all the machines on the same subnet.
    - If one of our entry guards is on the ExcludeNodes list, or the
      directory authorities don't think it's a good guard, treat it as
      if it were unlisted: stop using it as a guard, and throw it off
      the guards list if it stays that way for a long time.
    - Allow directory authorities to be marked separately as authorities
      for the v1 directory protocol, the v2 directory protocol, and
      as hidden service directories, to make it easier to retire old
      authorities. V1 authorities should set "HSAuthoritativeDir 1"
      to continue being hidden service authorities too.
    - Remove 8888 as a LongLivedPort, and add 6697 (IRCS).

  o Minor features, controller:
    - Fix CIRC controller events so that controllers can learn the
      identity digests of non-Named servers used in circuit paths.
    - Let controllers ask for more useful identifiers for servers. Instead
      of learning identity digests for un-Named servers and nicknames
      for Named servers, the new identifiers include digest, nickname,
      and indication of Named status. Off by default; see control-spec.txt
      for more information.
    - Add a "getinfo address" controller command so it can display Tor's
      best guess to the user.
    - New controller event to alert the controller when our server
      descriptor has changed.
    - Give more meaningful errors on controller authentication failure.

  o Minor features, other:
    - When asked to resolve a hostname, don't use non-exit servers unless
      requested to do so. This allows servers with broken DNS to be
      useful to the network.
    - Divide eventdns log messages into warn and info messages.
    - Reserve the nickname "Unnamed" for routers that can't pick
      a hostname: any router can call itself Unnamed; directory
      authorities will never allocate Unnamed to any particular router;
      clients won't believe that any router is the canonical Unnamed.
    - Only include function names in log messages for info/debug messages.
      For notice/warn/err, the content of the message should be clear on
      its own, and printing the function name only confuses users.
    - Avoid some false positives during reachability testing: don't try
      to test via a server that's on the same /24 as us.
    - If we fail to build a circuit to an intended enclave, and it's
      not mandatory that we use that enclave, stop wanting it.
    - When eventdns is enabled, allow multithreaded builds on NetBSD and
      OpenBSD. (We had previously disabled threads on these platforms
      because they didn't have working thread-safe resolver functions.)

  o Major bugfixes, anonymity/security:
    - If a client asked for a server by name, and there's a named server
      in our network-status but we don't have its descriptor yet, we
      could return an unnamed server instead.
    - Fix NetBSD bug that could allow someone to force uninitialized RAM
      to be sent to a server's DNS resolver. This only affects NetBSD
      and other platforms that do not bounds-check tolower().
    - Reject (most) attempts to use Tor circuits with length one. (If
      many people start using Tor as a one-hop proxy, exit nodes become
      a more attractive target for compromise.)
    - Just because your DirPort is open doesn't mean people should be
      able to remotely teach you about hidden service descriptors. Now
      only accept rendezvous posts if you've got HSAuthoritativeDir set.

  o Major bugfixes, other:
    - Don't crash on race condition in dns.c: tor_assert(!resolve->expire)
    - When a client asks the server to resolve (not connect to)
      an address, and it has a cached answer, give them the cached answer.
      Previously, the server would give them no answer at all.
    - Allow really slow clients to not hang up five minutes into their
      directory downloads (suggested by Adam J. Richter).
    - We were building exactly the wrong circuits when we anticipated
      hidden service requirements, meaning Tor would have to build all
      its circuits on demand.
    - Avoid crashing when we mmap a router cache file of size 0.
    - When testing reachability of our DirPort, don't launch new
      tests when there's already one in progress -- unreachable
      servers were stacking up dozens of testing streams.

  o Minor bugfixes, correctness:
    - If we're a directory mirror and we ask for "all" network status
      documents, we would discard status documents from authorities
      we don't recognize.
    - Avoid a memory corruption bug when creating a hash table for
      the first time.
    - Avoid controller-triggered crash when misusing certain commands
      from a v0 controller on platforms that do not handle
      printf("%s",NULL) gracefully.
    - Don't crash when a controller sends a third argument to an
      "extendcircuit" request.
    - Controller protocol fixes: fix encoding in "getinfo addr-mappings"
      response; fix error code when "getinfo dir/status/" fails.
    - Avoid crash when telling controller stream-status and a stream
      is detached.
    - Patch from Adam Langley to fix assert() in eventdns.c.
    - Fix a debug log message in eventdns to say "X resolved to Y"
      instead of "X resolved to X".
    - Make eventdns give strings for DNS errors, not just error numbers.
    - Track unreachable entry guards correctly: don't conflate
      'unreachable by us right now' with 'listed as down by the directory
      authorities'. With the old code, if a guard was unreachable by
      us but listed as running, it would clog our guard list forever.
    - Behave correctly in case we ever have a network with more than
      2GB/s total advertised capacity.
    - Make TrackExitHosts case-insensitive, and fix the behavior of
      ".suffix" TrackExitHosts items to avoid matching in the middle of
      an address.
    - Finally fix the openssl warnings from newer gccs that believe that
      ignoring a return value is okay, but casting a return value and
      then ignoring it is a sign of madness.
    - Prevent the contrib/exitlist script from printing the same
      result more than once.
    - Patch from Steve Hildrey: Generate network status correctly on
      non-versioning dirservers.
    - Don't listen to the X-Your-Address-Is hint if you did the lookup
      via Tor; otherwise you'll think you're the exit node's IP address.

  o Minor bugfixes, performance:
    - Two small performance improvements on parsing descriptors.
    - Major performance improvement on inserting descriptors: change
      algorithm from O(n^2) to O(n).
    - Make the common memory allocation path faster on machines where
      malloc(0) returns a pointer.
    - Start remembering X-Your-Address-Is directory hints even if you're
      a client, so you can become a server more smoothly.
    - Avoid duplicate entries on MyFamily line in server descriptor.

  o Packaging, features:
    - Remove architecture from OS X builds. The official builds are
      now universal binaries.
    - The Debian package now uses --verify-config when (re)starting,
      to distinguish configuration errors from other errors.
    - Update RPMs to require libevent 1.1b.

  o Packaging, bugfixes:
    - Patches so Tor builds with MinGW on Windows.
    - Patches so Tor might run on Cygwin again.
    - Resume building on non-gcc compilers and ancient gcc. Resume
      building with the -O0 compile flag. Resume building cleanly on
      Debian woody.
    - Run correctly on OS X platforms with case-sensitive filesystems.
    - Correct includes for net/if.h and net/pfvar.h on OpenBSD (from Tup).
    - Add autoconf checks so Tor can build on Solaris x86 again.

  o Documentation
    - Documented (and renamed) ServerDNSSearchDomains and
      ServerDNSResolvConfFile options.
    - Be clearer that the *ListenAddress directives can be repeated
      multiple times.


Changes in version 0.1.1.24 - 2006-09-29
  o Major bugfixes:
    - Allow really slow clients to not hang up five minutes into their
      directory downloads (suggested by Adam J. Richter).
    - Fix major performance regression from 0.1.0.x: instead of checking
      whether we have enough directory information every time we want to
      do something, only check when the directory information has changed.
      This should improve client CPU usage by 25-50%.
    - Don't crash if, after a server has been running for a while,
      it can't resolve its hostname.
    - When a client asks us to resolve (not connect to) an address,
      and we have a cached answer, give them the cached answer.
      Previously, we would give them no answer at all.

  o Minor bugfixes:
    - Allow Tor to start when RunAsDaemon is set but no logs are set.
    - Don't crash when the controller receives a third argument to an
      "extendcircuit" request.
    - Controller protocol fixes: fix encoding in "getinfo addr-mappings"
      response; fix error code when "getinfo dir/status/" fails.
    - Fix configure.in to not produce broken configure files with
      more recent versions of autoconf. Thanks to Clint for his auto*
      voodoo.
    - Fix security bug on NetBSD that could allow someone to force
      uninitialized RAM to be sent to a server's DNS resolver. This
      only affects NetBSD and other platforms that do not bounds-check
      tolower().
    - Warn user when using libevent 1.1a or earlier with win32 or kqueue
      methods: these are known to be buggy.
    - If we're a directory mirror and we ask for "all" network status
      documents, we would discard status documents from authorities
      we don't recognize.


Changes in version 0.1.2.1-alpha - 2006-08-27
  o Major features:
    - Add "eventdns" async dns library from Adam Langley, tweaked to
      build on OSX and Windows. Only enabled if you pass the
      --enable-eventdns argument to configure.
    - Allow servers with no hostname or IP address to learn their
      IP address by asking the directory authorities. This code only
      kicks in when you would normally have exited with a "no address"
      error. Nothing's authenticated, so use with care.
    - Rather than waiting a fixed amount of time between retrying
      application connections, we wait only 5 seconds for the first,
      10 seconds for the second, and 15 seconds for each retry after
      that. Hopefully this will improve the expected user experience.
    - Patch from Tup to add support for transparent AP connections:
      this basically bundles the functionality of trans-proxy-tor
      into the Tor mainline. Now hosts with compliant pf/netfilter
      implementations can redirect TCP connections straight to Tor
      without diverting through SOCKS. Needs docs.
    - Busy directory servers save lots of memory by spooling server
      descriptors, v1 directories, and v2 networkstatus docs to buffers
      as needed rather than en masse. Also mmap the cached-routers
      files, so we don't need to keep the whole thing in memory too.
    - Automatically avoid picking more than one node from the same
      /16 network when constructing a circuit.
    - Revise and clean up the torrc.sample that we ship with; add
      a section for BandwidthRate and BandwidthBurst.

  o Minor features:
    - Split circuit_t into origin_circuit_t and or_circuit_t, and
      split connection_t into edge, or, dir, control, and base structs.
      These will save quite a bit of memory on busy servers, and they'll
      also help us track down bugs in the code and bugs in the spec.
    - Experimentally re-enable kqueue on OSX when using libevent 1.1b
      or later. Log when we are doing this, so we can diagnose it when
      it fails. (Also, recommend libevent 1.1b for kqueue and
      win32 methods; deprecate libevent 1.0b harder; make libevent
      recommendation system saner.)
    - Start being able to build universal binaries on OS X (thanks
      to Phobos).
    - Export the default exit policy via the control port, so controllers
      don't need to guess what it is / will be later.
    - Add a man page entry for ProtocolWarnings.
    - Add TestVia config option to the man page.
    - Remove even more protocol-related warnings from Tor server logs,
      such as bad TLS handshakes and malformed begin cells.
    - Stop fetching descriptors if you're not a dir mirror and you
      haven't tried to establish any circuits lately. [This currently
      causes some dangerous behavior, because when you start up again
      you'll use your ancient server descriptors.]
    - New DirPort behavior: if you have your dirport set, you download
      descriptors aggressively like a directory mirror, whether or not
      your ORPort is set.
    - Get rid of the router_retry_connections notion. Now routers
      no longer try to rebuild long-term connections to directory
      authorities, and directory authorities no longer try to rebuild
      long-term connections to all servers. We still don't hang up
      connections in these two cases though -- we need to look at it
      more carefully to avoid flapping, and we likely need to wait til
      0.1.1.x is obsolete.
    - Drop compatibility with obsolete Tors that permit create cells
      to have the wrong circ_id_type.
    - Re-enable per-connection rate limiting. Get rid of the "OP
      bandwidth" concept. Lay groundwork for "bandwidth classes" --
      separate global buckets that apply depending on what sort of conn
      it is.
    - Start publishing one minute or so after we find our ORPort
      to be reachable. This will help reduce the number of descriptors
      we have for ourselves floating around, since it's quite likely
      other things (e.g. DirPort) will change during that minute too.
    - Fork the v1 directory protocol into its own spec document,
      and mark dir-spec.txt as the currently correct (v2) spec.

  o Major bugfixes:
    - When we find our DirPort to be reachable, publish a new descriptor
      so we'll tell the world (reported by pnx).
    - Publish a new descriptor after we hup/reload. This is important
      if our config has changed such that we'll want to start advertising
      our DirPort now, etc.
    - Allow Tor to start when RunAsDaemon is set but no logs are set.
    - When we have a state file we cannot parse, tell the user and
      move it aside. Now we avoid situations where the user starts
      Tor in 1904, Tor writes a state file with that timestamp in it,
      the user fixes her clock, and Tor refuses to start.
    - Fix configure.in to not produce broken configure files with
      more recent versions of autoconf. Thanks to Clint for his auto*
      voodoo.
    - "tor --verify-config" now exits with -1(255) or 0 depending on
      whether the config options are bad or good.
    - Resolve bug 321 when using dnsworkers: append a period to every
      address we resolve at the exit node, so that we do not accidentally
      pick up local addresses, and so that failing searches are retried
      in the resolver search domains. (This is already solved for
      eventdns.) (This breaks Blossom servers for now.)
    - If we are using an exit enclave and we can't connect, e.g. because
      its webserver is misconfigured to not listen on localhost, then
      back off and try connecting from somewhere else before we fail.

  o Minor bugfixes:
    - Start compiling on MinGW on Windows (patches from Mike Chiussi).
    - Start compiling on MSVC6 on Windows (patches from Frediano Ziglio).
    - Fix bug 314: Tor clients issued "unsafe socks" warnings even
      when the IP address is mapped through MapAddress to a hostname.
    - Start passing "ipv4" hints to getaddrinfo(), so servers don't do
      useless IPv6 DNS resolves.
    - Patch suggested by Karsten Loesing: respond to SIGNAL command
      before we execute the signal, in case the signal shuts us down.
    - Clean up AllowInvalidNodes man page entry.
    - Claim a commonname of Tor, rather than TOR, in TLS handshakes.
    - Add more asserts to track down an assert error on a windows Tor
      server with connection_add being called with socket == -1.
    - Handle reporting OR_CONN_EVENT_NEW events to the controller.
    - Fix misleading log messages: an entry guard that is "unlisted",
      as well as not known to be "down" (because we've never heard
      of it), is not therefore "up".
    - Remove code to special-case "-cvs" ending, since it has not
      actually mattered since 0.0.9.
    - Make our socks5 handling more robust to broken socks clients:
      throw out everything waiting on the buffer in between socks
      handshake phases, since they can't possibly (so the theory
      goes) have predicted what we plan to respond to them.


Changes in version 0.1.1.23 - 2006-07-30
  o Major bugfixes:
    - Fast Tor servers, especially exit nodes, were triggering asserts
      due to a bug in handling the list of pending DNS resolves. Some
      bugs still remain here; we're hunting them.
    - Entry guards could crash clients by sending unexpected input.
    - More fixes on reachability testing: if you find yourself reachable,
      then don't ever make any client requests (so you stop predicting
      circuits), then hup or have your clock jump, then later your IP
      changes, you won't think circuits are working, so you won't try to
      test reachability, so you won't publish.

  o Minor bugfixes:
    - Avoid a crash if the controller does a resetconf firewallports
      and then a setconf fascistfirewall=1.
    - Avoid an integer underflow when the dir authority decides whether
      a router is stable: we might wrongly label it stable, and compute
      a slightly wrong median stability, when a descriptor is published
      later than now.
    - Fix a place where we might trigger an assert if we can't build our
      own server descriptor yet.


Changes in version 0.1.1.22 - 2006-07-05
  o Major bugfixes:
    - Fix a big bug that was causing servers to not find themselves
      reachable if they changed IP addresses. Since only 0.1.1.22+
      servers can do reachability testing correctly, now we automatically
      make sure to test via one of these.
    - Fix to allow clients and mirrors to learn directory info from
      descriptor downloads that get cut off partway through.
    - Directory authorities had a bug in deciding if a newly published
      descriptor was novel enough to make everybody want a copy -- a few
      servers seem to be publishing new descriptors many times a minute.
  o Minor bugfixes:
    - Fix a rare bug that was causing some servers to complain about
      "closing wedged cpuworkers" and skip some circuit create requests.
    - Make the Exit flag in directory status documents actually work.


Changes in version 0.1.1.21 - 2006-06-10
  o Crash and assert fixes from 0.1.1.20:
    - Fix a rare crash on Tor servers that have enabled hibernation.
    - Fix a seg fault on startup for Tor networks that use only one
      directory authority.
    - Fix an assert from a race condition that occurs on Tor servers
      while exiting, where various threads are trying to log that they're
      exiting, and delete the logs, at the same time.
    - Make our unit tests pass again on certain obscure platforms.

  o Other fixes:
    - Add support for building SUSE RPM packages.
    - Speed up initial bootstrapping for clients: if we are making our
      first ever connection to any entry guard, then don't mark it down
      right after that.
    - When only one Tor server in the network is labelled as a guard,
      and we've already picked him, we would cycle endlessly picking him
      again, being unhappy about it, etc. Now we specifically exclude
      current guards when picking a new guard.
    - Servers send create cells more reliably after the TLS connection
      is established: we were sometimes forgetting to send half of them
      when we had more than one pending.
    - If we get a create cell that asks us to extend somewhere, but the
      Tor server there doesn't match the expected digest, we now send
      a destroy cell back, rather than silently doing nothing.
    - Make options->RedirectExit work again.
    - Make cookie authentication for the controller work again.
    - Stop being picky about unusual characters in the arguments to
      mapaddress. It's none of our business.
    - Add a new config option "TestVia" that lets you specify preferred
      middle hops to use for test circuits. Perhaps this will let me
      debug the reachability problems better.

  o Log / documentation fixes:
    - If we're a server and some peer has a broken TLS certificate, don't
      log about it unless ProtocolWarnings is set, i.e., we want to hear
      about protocol violations by others.
    - Fix spelling of VirtualAddrNetwork in man page.
    - Add a better explanation at the top of the autogenerated torrc file
      about what happened to our old torrc.


Changes in version 0.1.1.20 - 2006-05-23
  o Bugfixes:
    - Downgrade a log severity where servers complain that they're
      invalid.
    - Avoid a compile warning on FreeBSD.
    - Remove string size limit on NEWDESC messages; solve bug 291.
    - Correct the RunAsDaemon entry in the man page; ignore RunAsDaemon
      more thoroughly when we're running on windows.


Changes in version 0.1.1.19-rc - 2006-05-03
  o Minor bugs:
    - Regenerate our local descriptor if it's dirty and we try to use
      it locally (e.g. if it changes during reachability detection).
    - If we setconf our ORPort to 0, we continued to listen on the
      old ORPort and receive connections.
    - Avoid a second warning about machine/limits.h on Debian
      GNU/kFreeBSD.
    - Be willing to add our own routerinfo into the routerlist.
      Now authorities will include themselves in their directories
      and network-statuses.
    - Stop trying to upload rendezvous descriptors to every
      directory authority: only try the v1 authorities.
    - Servers no longer complain when they think they're not
      registered with the directory authorities. There were too many
      false positives.
    - Backport dist-rpm changes so rpms can be built without errors.

  o Features:
    - Implement an option, VirtualAddrMask, to set which addresses
      get handed out in response to mapaddress requests. This works
      around a bug in tsocks where 127.0.0.0/8 is never socksified.


Changes in version 0.1.1.18-rc - 2006-04-10
  o Major fixes:
    - Work harder to download live network-statuses from all the
      directory authorities we know about. Improve the threshold
      decision logic so we're more robust to edge cases.
    - When fetching rendezvous descriptors, we were willing to ask
      v2 authorities too, which would always return 404.

  o Minor fixes:
    - Stop listing down or invalid nodes in the v1 directory. This will
      reduce its bulk by about 1/3, and reduce load on directory
      mirrors.
    - When deciding whether a router is Fast or Guard-worthy, consider
      his advertised BandwidthRate and not just the BandwidthCapacity.
    - No longer ship INSTALL and README files -- they are useless now.
    - Force rpmbuild to behave and honor target_cpu.
    - Avoid warnings about machine/limits.h on Debian GNU/kFreeBSD.
    - Start to include translated versions of the tor-doc-*.html
      files, along with the screenshots. Still needs more work.
    - Start sending back 512 and 451 errors if mapaddress fails,
      rather than not sending anything back at all.
    - When we fail to bind or listen on an incoming or outgoing
      socket, we should close it before failing. otherwise we just
      leak it. (thanks to weasel for finding.)
    - Allow "getinfo dir/status/foo" to work, as long as your DirPort
      is enabled. (This is a hack, and will be fixed in 0.1.2.x.)
    - Make NoPublish (even though deprecated) work again.
    - Fix a minor security flaw where a versioning auth dirserver
      could list a recommended version many times in a row to make
      clients more convinced that it's recommended.
    - Fix crash bug if there are two unregistered servers running
      with the same nickname, one of them is down, and you ask for
      them by nickname in your EntryNodes or ExitNodes. Also, try
      to pick the one that's running rather than an arbitrary one.
    - Fix an infinite loop we could hit if we go offline for too long.
    - Complain when we hit WSAENOBUFS on recv() or write() too.
      Perhaps this will help us hunt the bug.
    - If you're not a versioning dirserver, don't put the string
      "client-versions \nserver-versions \n" in your network-status.
    - Lower the minimum required number of file descriptors to 1000,
      so we can have some overhead for Valgrind on Linux, where the
      default ulimit -n is 1024.

  o New features:
    - Add tor.dizum.com as the fifth authoritative directory server.
    - Add a new config option FetchUselessDescriptors, off by default,
      for when you plan to run "exitlist" on your client and you want
      to know about even the non-running descriptors.


Changes in version 0.1.1.17-rc - 2006-03-28
  o Major fixes:
    - Clients and servers since 0.1.1.10-alpha have been expiring
      connections whenever they are idle for 5 minutes and they *do*
      have circuits on them. Oops. With this new version, clients will
      discard their previous entry guard choices and avoid choosing
      entry guards running these flawed versions.
    - Fix memory leak when uncompressing concatenated zlib streams. This
      was causing substantial leaks over time on Tor servers.
    - The v1 directory was including servers as much as 48 hours old,
      because that's how the new routerlist->routers works. Now only
      include them if they're 20 hours old or less.

  o Minor fixes:
    - Resume building on irix64, netbsd 2.0, etc.
    - On non-gcc compilers (e.g. solaris), use "-g -O" instead of
      "-Wall -g -O2".
    - Stop writing the "router.desc" file, ever. Nothing uses it anymore,
      and it is confusing some users.
    - Mirrors stop caching the v1 directory so often.
    - Make the max number of old descriptors that a cache will hold
      rise with the number of directory authorities, so we can scale.
    - Change our win32 uname() hack to be more forgiving about what
      win32 versions it thinks it's found.

  o New features:
    - Add lefkada.eecs.harvard.edu as a fourth authoritative directory
      server.
    - When the controller's *setconf commands fail, collect an error
      message in a string and hand it back to the controller.
    - Make the v2 dir's "Fast" flag based on relative capacity, just
      like "Stable" is based on median uptime. Name everything in the
      top 7/8 Fast, and only the top 1/2 gets to be a Guard.
    - Log server fingerprint on startup, so new server operators don't
      have to go hunting around their filesystem for it.
    - Return a robots.txt on our dirport to discourage google indexing.
    - Let the controller ask for GETINFO dir/status/foo so it can ask
      directly rather than connecting to the dir port. Only works when
      dirport is set for now.

  o New config options rather than constants in the code:
    - SocksTimeout: How long do we let a socks connection wait
      unattached before we fail it?
    - CircuitBuildTimeout: Cull non-open circuits that were born
      at least this many seconds ago.
    - CircuitIdleTimeout: Cull open clean circuits that were born
      at least this many seconds ago.


Changes in version 0.1.1.16-rc - 2006-03-18
  o Bugfixes on 0.1.1.15-rc:
    - Fix assert when the controller asks to attachstream a connect-wait
      or resolve-wait stream.
    - Now do address rewriting when the controller asks us to attach
      to a particular circuit too. This will let Blossom specify
      "moria2.exit" without having to learn what moria2's IP address is.
    - Make the "tor --verify-config" command-line work again, so people
      can automatically check if their torrc will parse.
    - Authoritative dirservers no longer require an open connection from
      a server to consider him "reachable". We need this change because
      when we add new auth dirservers, old servers won't know not to
      hang up on them.
    - Let Tor build on Sun CC again.
    - Fix an off-by-one buffer size in dirserv.c that magically never
      hit our three authorities but broke sjmurdoch's own tor network.
    - If we as a directory mirror don't know of any v1 directory
      authorities, then don't try to cache any v1 directories.
    - Stop warning about unknown servers in our family when they are
      given as hex digests.
    - Stop complaining as quickly to the server operator that he
      hasn't registered his nickname/key binding.
    - Various cleanups so we can add new V2 Auth Dirservers.
    - Change "AllowUnverifiedNodes" to "AllowInvalidNodes", to
      reflect the updated flags in our v2 dir protocol.
    - Resume allowing non-printable characters for exit streams (both
      for connecting and for resolving). Now we tolerate applications
      that don't follow the RFCs. But continue to block malformed names
      at the socks side.

  o Bugfixes on 0.1.0.x:
    - Fix assert bug in close_logs(): when we close and delete logs,
      remove them all from the global "logfiles" list.
    - Fix minor integer overflow in calculating when we expect to use up
      our bandwidth allocation before hibernating.
    - Fix a couple of bugs in OpenSSL detection. Also, deal better when
      there are multiple SSLs installed with different versions.
    - When we try to be a server and Address is not explicitly set and
      our hostname resolves to a private IP address, try to use an
      interface address if it has a public address. Now Windows machines
      that think of themselves as localhost can work by default.

  o New features:
    - Let the controller ask for GETINFO dir/server/foo so it can ask
      directly rather than connecting to the dir port.
    - Let the controller tell us about certain router descriptors
      that it doesn't want Tor to use in circuits. Implement
      SETROUTERPURPOSE and modify +POSTDESCRIPTOR to do this.
    - New config option SafeSocks to reject all application connections
      using unsafe socks protocols. Defaults to off.


Changes in version 0.1.1.15-rc - 2006-03-11
  o Bugfixes and cleanups:
    - When we're printing strings from the network, don't try to print
      non-printable characters. This protects us against shell escape
      sequence exploits, and also against attacks to fool humans into
      misreading their logs.
    - Fix a bug where Tor would fail to establish any connections if you
      left it off for 24 hours and then started it: we were happy with
      the obsolete network statuses, but they all referred to router
      descriptors that were too old to fetch, so we ended up with no
      valid router descriptors.
    - Fix a seg fault in the controller's "getinfo orconn-status"
      command while listing status on incoming handshaking connections.
      Introduce a status name "NEW" for these connections.
    - If we get a linelist or linelist_s config option from the torrc
      (e.g. ExitPolicy) and it has no value, warn and skip rather than
      silently resetting it to its default.
    - Don't abandon entry guards until they've been down or gone for
      a whole month.
    - Cleaner and quieter log messages.

  o New features:
    - New controller signal NEWNYM that makes new application requests
      use clean circuits.
    - Add a new circuit purpose 'controller' to let the controller ask
      for a circuit that Tor won't try to use. Extend the EXTENDCIRCUIT
      controller command to let you specify the purpose if you're
      starting a new circuit.  Add a new SETCIRCUITPURPOSE controller
      command to let you change a circuit's purpose after it's been
      created.
    - Accept "private:*" in routerdesc exit policies; not generated yet
      because older Tors do not understand it.
    - Add BSD-style contributed startup script "rc.subr" from Peter
      Thoenen.


Changes in version 0.1.1.14-alpha - 2006-02-20
  o Bugfixes on 0.1.1.x:
    - Don't die if we ask for a stdout or stderr log (even implicitly)
      and we're set to RunAsDaemon -- just warn.
    - We still had a few bugs in the OR connection rotation code that
      caused directory servers to slowly aggregate connections to other
      fast Tor servers. This time for sure!
    - Make log entries on Win32 include the name of the function again.
    - We were treating a pair of exit policies if they were equal even
      if one said accept and the other said reject -- causing us to
      not always publish a new descriptor since we thought nothing
      had changed.
    - Retry pending server downloads as well as pending networkstatus
      downloads when we unexpectedly get a socks request.
    - We were ignoring the IS_FAST flag in the directory status,
      meaning we were willing to pick trivial-bandwidth nodes for "fast"
      connections.
    - If the controller's SAVECONF command fails (e.g. due to file
      permissions), let the controller know that it failed.

  o Features:
    - If we're trying to be a Tor server and running Windows 95/98/ME
      as a server, explain that we'll likely crash.
    - When we're a server, a client asks for an old-style directory,
      and our write bucket is empty, don't give it to him. This way
      small servers can continue to serve the directory *sometimes*,
      without getting overloaded.
    - Compress exit policies even more -- look for duplicate lines
      and remove them.
    - Clients now honor the "guard" flag in the router status when
      picking entry guards, rather than looking at is_fast or is_stable.
    - Retain unrecognized lines in $DATADIR/state file, so that we can
      be forward-compatible.
    - Generate 18.0.0.0/8 address policy format in descs when we can;
      warn when the mask is not reducible to a bit-prefix.
    - Let the user set ControlListenAddress in the torrc.  This can be
      dangerous, but there are some cases (like a secured LAN) where it
      makes sense.
    - Split ReachableAddresses into ReachableDirAddresses and
      ReachableORAddresses, so we can restrict Dir conns to port 80
      and OR conns to port 443.
    - Now we can target arch and OS in rpm builds (contributed by
      Phobos). Also make the resulting dist-rpm filename match the
      target arch.
    - New config options to help controllers: FetchServerDescriptors
      and FetchHidServDescriptors for whether to fetch server
      info and hidserv info or let the controller do it, and
      PublishServerDescriptor and PublishHidServDescriptors.
    - Also let the controller set the __AllDirActionsPrivate config
      option if you want all directory fetches/publishes to happen via
      Tor (it assumes your controller bootstraps your circuits).


Changes in version 0.1.0.17 - 2006-02-17
  o Crash bugfixes on 0.1.0.x:
    - When servers with a non-zero DirPort came out of hibernation,
      sometimes they would trigger an assert.

  o Other important bugfixes:
    - On platforms that don't have getrlimit (like Windows), we were
      artificially constraining ourselves to a max of 1024
      connections. Now just assume that we can handle as many as 15000
      connections. Hopefully this won't cause other problems.

  o Backported features:
    - When we're a server, a client asks for an old-style directory,
      and our write bucket is empty, don't give it to him. This way
      small servers can continue to serve the directory *sometimes*,
      without getting overloaded.
    - Whenever you get a 503 in response to a directory fetch, try
      once more. This will become important once servers start sending
      503's whenever they feel busy.
    - Fetch a new directory every 120 minutes, not every 40 minutes.
      Now that we have hundreds of thousands of users running the old
      directory algorithm, it's starting to hurt a lot.
    - Bump up the period for forcing a hidden service descriptor upload
      from 20 minutes to 1 hour.


Changes in version 0.1.1.13-alpha - 2006-02-09
  o Crashes in 0.1.1.x:
    - When you tried to setconf ORPort via the controller, Tor would
      crash. So people using TorCP to become a server were sad.
    - Solve (I hope) the stack-smashing bug that we were seeing on fast
      servers. The problem appears to be something do with OpenSSL's
      random number generation, or how we call it, or something. Let me
      know if the crashes continue.
    - Turn crypto hardware acceleration off by default, until we find
      somebody smart who can test it for us. (It appears to produce
      seg faults in at least some cases.)
    - Fix a rare assert error when we've tried all intro points for
      a hidden service and we try fetching the service descriptor again:
      "Assertion conn->state != AP_CONN_STATE_RENDDESC_WAIT failed"

  o Major fixes:
    - Fix a major load balance bug: we were round-robining in 16 KB
      chunks, and servers with bandwidthrate of 20 KB, while downloading
      a 600 KB directory, would starve their other connections. Now we
      try to be a bit more fair.
    - Dir authorities and mirrors were never expiring the newest
      descriptor for each server, causing memory and directory bloat.
    - Fix memory-bloating and connection-bloating bug on servers: We
      were never closing any connection that had ever had a circuit on
      it, because we were checking conn->n_circuits == 0, yet we had a
      bug that let it go negative.
    - Make Tor work using squid as your http proxy again -- squid
      returns an error if you ask for a URL that's too long, and it uses
      a really generic error message. Plus, many people are behind a
      transparent squid so they don't even realize it.
    - On platforms that don't have getrlimit (like Windows), we were
      artificially constraining ourselves to a max of 1024
      connections. Now just assume that we can handle as many as 15000
      connections. Hopefully this won't cause other problems.
    - Add a new config option ExitPolicyRejectPrivate which defaults to
      1. This means all exit policies will begin with rejecting private
      addresses, unless the server operator explicitly turns it off.

  o Major features:
    - Clients not longer download descriptors for non-running
      descriptors.
    - Before we add new directory authorities, we should make it
      clear that only v1 authorities should receive/publish hidden
      service descriptors.

  o Minor features:
    - As soon as we've fetched some more directory info, immediately
      try to download more server descriptors. This way we don't have
      a 10 second pause during initial bootstrapping.
    - Remove even more loud log messages that the server operator can't
      do anything about.
    - When we're running an obsolete or un-recommended version, make
      the log message more clear about what the problem is and what
      versions *are* still recommended.
    - Provide a more useful warn message when our onion queue gets full:
      the CPU is too slow or the exit policy is too liberal.
    - Don't warn when we receive a 503 from a dirserver/cache -- this
      will pave the way for them being able to refuse if they're busy.
    - When we fail to bind a listener, try to provide a more useful
      log message: e.g., "Is Tor already running?"
    - Adjust tor-spec to parameterize cell and key lengths. Now Ian
      Goldberg can prove things about our handshake protocol more
      easily.
    - MaxConn has been obsolete for a while now. Document the ConnLimit
      config option, which is a *minimum* number of file descriptors
      that must be available else Tor refuses to start.
    - Apply Matt Ghali's --with-syslog-facility patch to ./configure
      if you log to syslog and want something other than LOG_DAEMON.
    - Make dirservers generate a separate "guard" flag to mean,
      "would make a good entry guard". Make clients parse it and vote
      on it. Not used by clients yet.
    - Implement --with-libevent-dir option to ./configure. Also, improve
      search techniques to find libevent, and use those for openssl too.
    - Bump the default bandwidthrate to 3 MB, and burst to 6 MB
    - Only start testing reachability once we've established a
      circuit. This will make startup on dirservers less noisy.
    - Don't try to upload hidden service descriptors until we have
      established a circuit.
    - Fix the controller's "attachstream 0" command to treat conn like
      it just connected, doing address remapping, handling .exit and
      .onion idioms, and so on. Now we're more uniform in making sure
      that the controller hears about new and closing connections.


Changes in version 0.1.1.12-alpha - 2006-01-11
  o Bugfixes on 0.1.1.x:
    - The fix to close duplicate server connections was closing all
      Tor client connections if they didn't establish a circuit
      quickly enough. Oops.
    - Fix minor memory issue (double-free) that happened on exit.

  o Bugfixes on 0.1.0.x:
    - Tor didn't warn when it failed to open a log file.


Changes in version 0.1.1.11-alpha - 2006-01-10
  o Crashes in 0.1.1.x:
    - Include all the assert/crash fixes from 0.1.0.16.
    - If you start Tor and then quit very quickly, there were some
      races that tried to free things that weren't allocated yet.
    - Fix a rare memory stomp if you're running hidden services.
    - Fix segfault when specifying DirServer in config without nickname.
    - Fix a seg fault when you finish connecting to a server but at
      that moment you dump his server descriptor.
    - Extendcircuit and Attachstream controller commands would
      assert/crash if you don't give them enough arguments.
    - Fix an assert error when we're out of space in the connection_list
      and we try to post a hidden service descriptor (reported by weasel).
    - If you specify a relative torrc path and you set RunAsDaemon in
      your torrc, then it chdir()'s to the new directory. If you HUP,
      it tries to load the new torrc location, fails, and exits.
      The fix: no longer allow a relative path to torrc using -f.

  o Major features:
    - Implement "entry guards": automatically choose a handful of entry
      nodes and stick with them for all circuits. Only pick new guards
      when the ones you have are unsuitable, and if the old guards
      become suitable again, switch back. This will increase security
      dramatically against certain end-point attacks. The EntryNodes
      config option now provides some hints about which entry guards you
      want to use most; and StrictEntryNodes means to only use those.
    - New directory logic: download by descriptor digest, not by
      fingerprint. Caches try to download all listed digests from
      authorities; clients try to download "best" digests from caches.
      This avoids partitioning and isolating attacks better.
    - Make the "stable" router flag in network-status be the median of
      the uptimes of running valid servers, and make clients pay
      attention to the network-status flags. Thus the cutoff adapts
      to the stability of the network as a whole, making IRC, IM, etc
      connections more reliable.

  o Major fixes:
    - Tor servers with dynamic IP addresses were needing to wait 18
      hours before they could start doing reachability testing using
      the new IP address and ports. This is because they were using
      the internal descriptor to learn what to test, yet they were only
      rebuilding the descriptor once they decided they were reachable.
    - Tor 0.1.1.9 and 0.1.1.10 had a serious bug that caused clients
      to download certain server descriptors, throw them away, and then
      fetch them again after 30 minutes. Now mirrors throw away these
      server descriptors so clients can't get them.
    - We were leaving duplicate connections to other ORs open for a week,
      rather than closing them once we detect a duplicate. This only
      really affected authdirservers, but it affected them a lot.
    - Spread the authdirservers' reachability testing over the entire
      testing interval, so we don't try to do 500 TLS's at once every
      20 minutes.

  o Minor fixes:
    - If the network is down, and we try to connect to a conn because
      we have a circuit in mind, and we timeout (30 seconds) because the
      network never answers, we were expiring the circuit, but we weren't
      obsoleting the connection or telling the entry_guards functions.
    - Some Tor servers process billions of cells per day. These statistics
      need to be uint64_t's.
    - Check for integer overflows in more places, when adding elements
      to smartlists. This could possibly prevent a buffer overflow
      on malicious huge inputs. I don't see any, but I haven't looked
      carefully.
    - ReachableAddresses kept growing new "reject *:*" lines on every
      setconf/reload.
    - When you "setconf log" via the controller, it should remove all
      logs. We were automatically adding back in a "log notice stdout".
    - Newly bootstrapped Tor networks couldn't establish hidden service
      circuits until they had nodes with high uptime. Be more tolerant.
    - We were marking servers down when they could not answer every piece
      of the directory request we sent them. This was far too harsh.
    - Fix the torify (tsocks) config file to not use Tor for localhost
      connections.
    - Directory authorities now go to the proper authority when asking for
      a networkstatus, even when they want a compressed one.
    - Fix a harmless bug that was causing Tor servers to log
      "Got an end because of misc error, but we're not an AP. Closing."
    - Authorities were treating their own descriptor changes as cosmetic,
      meaning the descriptor available in the network-status and the
      descriptor that clients downloaded were different.
    - The OS X installer was adding a symlink for tor_resolve but
      the binary was called tor-resolve (reported by Thomas Hardly).
    - Workaround a problem with some http proxies where they refuse GET
      requests that specify "Content-Length: 0" (reported by Adrian).
    - Fix wrong log message when you add a "HiddenServiceNodes" config
      line without any HiddenServiceDir line (reported by Chris Thomas).

  o Minor features:
    - Write the TorVersion into the state file so we have a prayer of
      keeping forward and backward compatibility.
    - Revive the FascistFirewall config option rather than eliminating it:
      now it's a synonym for ReachableAddresses *:80,*:443.
    - Clients choose directory servers from the network status lists,
      not from their internal list of router descriptors. Now they can
      go to caches directly rather than needing to go to authorities
      to bootstrap.
    - Directory authorities ignore router descriptors that have only
      cosmetic differences: do this for 0.1.0.x servers now too.
    - Add a new flag to network-status indicating whether the server
      can answer v2 directory requests too.
    - Authdirs now stop whining so loudly about bad descriptors that
      they fetch from other dirservers. So when there's a log complaint,
      it's for sure from a freshly uploaded descriptor.
    - Reduce memory requirements in our structs by changing the order
      of fields.
    - There used to be two ways to specify your listening ports in a
      server descriptor: on the "router" line and with a separate "ports"
      line. Remove support for the "ports" line.
    - New config option "AuthDirRejectUnlisted" for auth dirservers as
      a panic button: if we get flooded with unusable servers we can
      revert to only listing servers in the approved-routers file.
    - Auth dir servers can now mark a fingerprint as "!reject" or
      "!invalid" in the approved-routers file (as its nickname), to
      refuse descriptors outright or include them but marked as invalid.
    - Servers store bandwidth history across restarts/crashes.
    - Add reasons to DESTROY and RELAY_TRUNCATED cells, so clients can
      get a better idea of why their circuits failed. Not used yet.
    - Directory mirrors now cache up to 16 unrecognized network-status
      docs. Now we can add new authdirservers and they'll be cached too.
    - When picking a random directory, prefer non-authorities if any
      are known.
    - New controller option "getinfo desc/all-recent" to fetch the
      latest server descriptor for every router that Tor knows about.


Changes in version 0.1.0.16 - 2006-01-02
  o Crash bugfixes on 0.1.0.x:
    - On Windows, build with a libevent patch from "I-M Weasel" to avoid
      corrupting the heap, losing FDs, or crashing when we need to resize
      the fd_sets. (This affects the Win32 binaries, not Tor's sources.)
    - It turns out sparc64 platforms crash on unaligned memory access
      too -- so detect and avoid this.
    - Handle truncated compressed data correctly (by detecting it and
      giving an error).
    - Fix possible-but-unlikely free(NULL) in control.c.
    - When we were closing connections, there was a rare case that
      stomped on memory, triggering seg faults and asserts.
    - Avoid potential infinite recursion when building a descriptor. (We
      don't know that it ever happened, but better to fix it anyway.)
    - We were neglecting to unlink marked circuits from soon-to-close OR
      connections, which caused some rare scribbling on freed memory.
    - Fix a memory stomping race bug when closing the joining point of two
      rendezvous circuits.
    - Fix an assert in time parsing found by Steven Murdoch.

  o Other bugfixes on 0.1.0.x:
    - When we're doing reachability testing, provide more useful log
      messages so the operator knows what to expect.
    - Do not check whether DirPort is reachable when we are suppressing
      advertising it because of hibernation.
    - When building with -static or on Solaris, we sometimes needed -ldl.
    - One of the dirservers (tor26) changed its IP address.
    - When we're deciding whether a stream has enough circuits around
      that can handle it, count the freshly dirty ones and not the ones
      that are so dirty they won't be able to handle it.
    - When we're expiring old circuits, we had a logic error that caused
      us to close new rendezvous circuits rather than old ones.
    - Give a more helpful log message when you try to change ORPort via
      the controller: you should upgrade Tor if you want that to work.
    - We were failing to parse Tor versions that start with "Tor ".
    - Tolerate faulty streams better: when a stream fails for reason
      exitpolicy, stop assuming that the router is lying about his exit
      policy. When a stream fails for reason misc, allow it to retry just
      as if it was resolvefailed. When a stream has failed three times,
      reset its failure count so we can try again and get all three tries.


Changes in version 0.1.1.10-alpha - 2005-12-11
  o Correctness bugfixes on 0.1.0.x:
    - On Windows, build with a libevent patch from "I-M Weasel" to avoid
      corrupting the heap, losing FDs, or crashing when we need to resize
      the fd_sets. (This affects the Win32 binaries, not Tor's sources.)
    - Stop doing the complex voodoo overkill checking for insecure
      Diffie-Hellman keys. Just check if it's in [2,p-2] and be happy.
    - When we were closing connections, there was a rare case that
      stomped on memory, triggering seg faults and asserts.
    - We were neglecting to unlink marked circuits from soon-to-close OR
      connections, which caused some rare scribbling on freed memory.
    - When we're deciding whether a stream has enough circuits around
      that can handle it, count the freshly dirty ones and not the ones
      that are so dirty they won't be able to handle it.
    - Recover better from TCP connections to Tor servers that are
      broken but don't tell you (it happens!); and rotate TLS
      connections once a week.
    - When we're expiring old circuits, we had a logic error that caused
      us to close new rendezvous circuits rather than old ones.
    - Fix a scary-looking but apparently harmless bug where circuits
      would sometimes start out in state CIRCUIT_STATE_OR_WAIT at
      servers, and never switch to state CIRCUIT_STATE_OPEN.
    - When building with -static or on Solaris, we sometimes needed to
      build with -ldl.
    - Give a useful message when people run Tor as the wrong user,
      rather than telling them to start chowning random directories.
    - We were failing to inform the controller about new .onion streams.

  o Security bugfixes on 0.1.0.x:
    - Refuse server descriptors if the fingerprint line doesn't match
      the included identity key. Tor doesn't care, but other apps (and
      humans) might actually be trusting the fingerprint line.
    - We used to kill the circuit when we receive a relay command we
      don't recognize. Now we just drop it.
    - Start obeying our firewall options more rigorously:
      . If we can't get to a dirserver directly, try going via Tor.
      . Don't ever try to connect (as a client) to a place our
        firewall options forbid.
      . If we specify a proxy and also firewall options, obey the
        firewall options even when we're using the proxy: some proxies
        can only proxy to certain destinations.
    - Fix a bug found by Lasse Overlier: when we were making internal
      circuits (intended to be cannibalized later for rendezvous and
      introduction circuits), we were picking them so that they had
      useful exit nodes. There was no need for this, and it actually
      aids some statistical attacks.
    - Start treating internal circuits and exit circuits separately.
      It's important to keep them separate because internal circuits
      have their last hops picked like middle hops, rather than like
      exit hops. So exiting on them will break the user's expectations.

  o Bugfixes on 0.1.1.x:
    - Take out the mis-feature where we tried to detect IP address
      flapping for people with DynDNS, and chose not to upload a new
      server descriptor sometimes.
    - Try to be compatible with OpenSSL 0.9.6 again.
    - Log fix: when the controller is logging about .onion addresses,
      sometimes it didn't include the ".onion" part of the address.
    - Don't try to modify options->DirServers internally -- if the
      user didn't specify any, just add the default ones directly to
      the trusted dirserver list. This fixes a bug where people running
      controllers would use SETCONF on some totally unrelated config
      option, and Tor would start yelling at them about changing their
      DirServer lines.
    - Let the controller's redirectstream command specify a port, in
      case the controller wants to change that too.
    - When we requested a pile of server descriptors, we sometimes
      accidentally launched a duplicate request for the first one.
    - Bugfix for trackhostexits: write down the fingerprint of the
      chosen exit, not its nickname, because the chosen exit might not
      be verified.
    - When parsing foo.exit, if foo is unknown, and we are leaving
      circuits unattached, set the chosen_exit field and leave the
      address empty. This matters because controllers got confused
      otherwise.
    - Directory authorities no longer try to download server
      descriptors that they know they will reject.

  o Features and updates:
    - Replace balanced trees with hash tables: this should make stuff
      significantly faster.
    - Resume using the AES counter-mode implementation that we ship,
      rather than OpenSSL's. Ours is significantly faster.
    - Many other CPU and memory improvements.
    - Add a new config option FastFirstHopPK (on by default) so clients
      do a trivial crypto handshake for their first hop, since TLS has
      already taken care of confidentiality and authentication.
    - Add a new config option TestSocks so people can see if their
      applications are using socks4, socks4a, socks5-with-ip, or
      socks5-with-hostname. This way they don't have to keep mucking
      with tcpdump and wondering if something got cached somewhere.
    - Warn when listening on a public address for socks. I suspect a
      lot of people are setting themselves up as open socks proxies,
      and they have no idea that jerks on the Internet are using them,
      since they simply proxy the traffic into the Tor network.
    - Add "private:*" as an alias in configuration for policies. Now
      you can simplify your exit policy rather than needing to list
      every single internal or nonroutable network space.
    - Add a new controller event type that allows controllers to get
      all server descriptors that were uploaded to a router in its role
      as authoritative dirserver.
    - Start shipping socks-extensions.txt, tor-doc-unix.html,
      tor-doc-server.html, and stylesheet.css in the tarball.
    - Stop shipping tor-doc.html in the tarball.


Changes in version 0.1.1.9-alpha - 2005-11-15
  o Usability improvements:
    - Start calling it FooListenAddress rather than FooBindAddress,
      since few of our users know what it means to bind an address
      or port.
    - Reduce clutter in server logs. We're going to try to make
      them actually usable now. New config option ProtocolWarnings that
      lets you hear about how _other Tors_ are breaking the protocol. Off
      by default.
    - Divide log messages into logging domains. Once we put some sort
      of interface on this, it will let people looking at more verbose
      log levels specify the topics they want to hear more about.
    - Make directory servers return better http 404 error messages
      instead of a generic "Servers unavailable".
    - Check for even more Windows version flags when writing the platform
      string in server descriptors, and note any we don't recognize.
    - Clean up more of the OpenSSL memory when exiting, so we can detect
      memory leaks better.
    - Make directory authorities be non-versioning, non-naming by
      default. Now we can add new directory servers without requiring
      their operators to pay close attention.
    - When logging via syslog, include the pid whenever we provide
      a log entry. Suggested by Todd Fries.

  o Performance improvements:
    - Directory servers now silently throw away new descriptors that
      haven't changed much if the timestamps are similar. We do this to
      tolerate older Tor servers that upload a new descriptor every 15
      minutes. (It seemed like a good idea at the time.)
    - Inline bottleneck smartlist functions; use fast versions by default.
    - Add a "Map from digest to void*" abstraction digestmap_t so we
      can do less hex encoding/decoding. Use it in router_get_by_digest()
      to resolve a performance bottleneck.
    - Allow tor_gzip_uncompress to extract as much as possible from
      truncated compressed data. Try to extract as many
      descriptors as possible from truncated http responses (when
      DIR_PURPOSE_FETCH_ROUTERDESC).
    - Make circ->onionskin a pointer, not a static array. moria2 was using
      125000 circuit_t's after it had been up for a few weeks, which
      translates to 20+ megs of wasted space.
    - The private half of our EDH handshake keys are now chosen out
      of 320 bits, not 1024 bits. (Suggested by Ian Goldberg.)

  o Security improvements:
    - Start making directory caches retain old routerinfos, so soon
      clients can start asking by digest of descriptor rather than by
      fingerprint of server.
    - Add half our entropy from RAND_poll in OpenSSL.  This knows how
      to use egd (if present), openbsd weirdness (if present), vms/os2
      weirdness (if we ever port there), and more in the future.

  o Bugfixes on 0.1.0.x:
    - Do round-robin writes of at most 16 kB per write. This might be
      more fair on loaded Tor servers, and it might resolve our Windows
      crash bug. It might also slow things down.
    - Our TLS handshakes were generating a single public/private
      keypair for the TLS context, rather than making a new one for
      each new connections. Oops. (But we were still rotating them
      periodically, so it's not so bad.)
    - When we were cannibalizing a circuit with a particular exit
      node in mind, we weren't checking to see if that exit node was
      already present earlier in the circuit. Oops.
    - When a Tor server's IP changes (e.g. from a dyndns address),
      upload a new descriptor so clients will learn too.
    - Really busy servers were keeping enough circuits open on stable
      connections that they were wrapping around the circuit_id
      space. (It's only two bytes.) This exposed a bug where we would
      feel free to reuse a circuit_id even if it still exists but has
      been marked for close. Try to fix this bug. Some bug remains.
    - If we would close a stream early (e.g. it asks for a .exit that
      we know would refuse it) but the LeaveStreamsUnattached config
      option is set by the controller, then don't close it.

  o Bugfixes on 0.1.1.8-alpha:
    - Fix a big pile of memory leaks, some of them serious.
    - Do not try to download a routerdesc if we would immediately reject
      it as obsolete.
    - Resume inserting a newline between all router descriptors when
      generating (old style) signed directories, since our spec says
      we do.
    - When providing content-type application/octet-stream for
      server descriptors using .z, we were leaving out the
      content-encoding header. Oops. (Everything tolerated this just
      fine, but that doesn't mean we need to be part of the problem.)
    - Fix a potential seg fault in getconf and getinfo using version 1
      of the controller protocol.
    - Avoid crash: do not check whether DirPort is reachable when we
      are suppressing it because of hibernation.
    - Make --hash-password not crash on exit.


Changes in version 0.1.1.8-alpha - 2005-10-07
  o New features (major):
    - Clients don't download or use the directory anymore. Now they
      download and use network-statuses from the trusted dirservers,
      and fetch individual server descriptors as needed from mirrors.
      See dir-spec.txt for all the gory details.
    - Be more conservative about whether to advertise our DirPort.
      The main change is to not advertise if we're running at capacity
      and either a) we could hibernate or b) our capacity is low and
      we're using a default DirPort.
    - Use OpenSSL's AES when OpenSSL has version 0.9.7 or later.

  o New features (minor):
    - Try to be smart about when to retry network-status and
      server-descriptor fetches. Still needs some tuning.
    - Stop parsing, storing, or using running-routers output (but
      mirrors still cache and serve it).
    - Consider a threshold of versioning dirservers (dirservers who have
      an opinion about which Tor versions are still recommended) before
      deciding whether to warn the user that he's obsolete.
    - Dirservers can now reject/invalidate by key and IP, with the
      config options "AuthDirInvalid" and "AuthDirReject". This is
      useful since currently we automatically list servers as running
      and usable even if we know they're jerks.
    - Provide dire warnings to any users who set DirServer; move it out
      of torrc.sample and into torrc.complete.
    - Add MyFamily to torrc.sample in the server section.
    - Add nicknames to the DirServer line, so we can refer to them
      without requiring all our users to memorize their IP addresses.
    - When we get an EOF or a timeout on a directory connection, note
      how many bytes of serverdesc we are dropping. This will help
      us determine whether it is smart to parse incomplete serverdesc
      responses.
    - Add a new function to "change pseudonyms" -- that is, to stop
      using any currently-dirty circuits for new streams, so we don't
      link new actions to old actions. Currently it's only called on
      HUP (or SIGNAL RELOAD).
    - On sighup, if UseHelperNodes changed to 1, use new circuits.
    - Start using RAND_bytes rather than RAND_pseudo_bytes from
      OpenSSL. Also, reseed our entropy every hour, not just at
      startup. And entropy in 512-bit chunks, not 160-bit chunks.

  o Fixes on 0.1.1.7-alpha:
    - Nobody ever implemented EVENT_ADDRMAP for control protocol
      version 0, so don't let version 0 controllers ask for it.
    - If you requested something with too many newlines via the
      v1 controller protocol, you could crash tor.
    - Fix a number of memory leaks, including some pretty serious ones.
    - Re-enable DirPort testing again, so Tor servers will be willing
      to advertise their DirPort if it's reachable.
    - On TLS handshake, only check the other router's nickname against
      its expected nickname if is_named is set.

  o Fixes forward-ported from 0.1.0.15:
    - Don't crash when we don't have any spare file descriptors and we
      try to spawn a dns or cpu worker.
    - Make the numbers in read-history and write-history into uint64s,
      so they don't overflow and publish negatives in the descriptor.

  o Fixes on 0.1.0.x:
    - For the OS X package's modified privoxy config file, comment
      out the "logfile" line so we don't log everything passed
      through privoxy.
    - We were whining about using socks4 or socks5-with-local-lookup
      even when it's an IP in the "virtual" range we designed exactly
      for this case.
    - We were leaking some memory every time the client changes IPs.
    - Never call free() on tor_malloc()d memory. This will help us
      use dmalloc to detect memory leaks.
    - Check for named servers when looking them up by nickname;
      warn when we'recalling a non-named server by its nickname;
      don't warn twice about the same name.
    - Try to list MyFamily elements by key, not by nickname, and warn
      if we've not heard of the server.
    - Make windows platform detection (uname equivalent) smarter.
    - It turns out sparc64 doesn't like unaligned access either.


Changes in version 0.1.0.15 - 2005-09-23
  o Bugfixes on 0.1.0.x:
    - Reject ports 465 and 587 (spam targets) in default exit policy.
    - Don't crash when we don't have any spare file descriptors and we
      try to spawn a dns or cpu worker.
    - Get rid of IgnoreVersion undocumented config option, and make us
      only warn, never exit, when we're running an obsolete version.
    - Don't try to print a null string when your server finds itself to
      be unreachable and the Address config option is empty.
    - Make the numbers in read-history and write-history into uint64s,
      so they don't overflow and publish negatives in the descriptor.
    - Fix a minor memory leak in smartlist_string_remove().
    - We were only allowing ourselves to upload a server descriptor at
      most every 20 minutes, even if it changed earlier than that.
    - Clean up log entries that pointed to old URLs.


Changes in version 0.1.1.7-alpha - 2005-09-14
  o Fixes on 0.1.1.6-alpha:
    - Exit servers were crashing when people asked them to make a
      connection to an address not in their exit policy.
    - Looking up a non-existent stream for a v1 control connection would
      cause a segfault.
    - Fix a seg fault if we ask a dirserver for a descriptor by
      fingerprint but he doesn't know about him.
    - SETCONF was appending items to linelists, not clearing them.
    - SETCONF SocksBindAddress killed Tor if it fails to bind. Now back
      out and refuse the setconf if it would fail.
    - Downgrade the dirserver log messages when whining about
      unreachability.

  o New features:
    - Add Peter Palfrader's check-tor script to tor/contrib/
      It lets you easily check whether a given server (referenced by
      nickname) is reachable by you.
    - Numerous changes to move towards client-side v2 directories. Not
      enabled yet.

  o Fixes on 0.1.0.x:
    - If the user gave tor an odd number of command-line arguments,
      we were silently ignoring the last one. Now we complain and fail.
      [This wins the oldest-bug prize -- this bug has been present since
       November 2002, as released in Tor 0.0.0.]
    - Do not use unaligned memory access on alpha, mips, or mipsel.
      It *works*, but is very slow, so we treat them as if it doesn't.
    - Retry directory requests if we fail to get an answer we like
      from a given dirserver (we were retrying before, but only if
      we fail to connect).
    - When writing the RecommendedVersions line, sort them first.
    - When the client asked for a rendezvous port that the hidden
      service didn't want to provide, we were sending an IP address
      back along with the end cell. Fortunately, it was zero. But stop
      that anyway.
    - Correct "your server is reachable" log entries to indicate that
      it was self-testing that told us so.


Changes in version 0.1.1.6-alpha - 2005-09-09
  o Fixes on 0.1.1.5-alpha:
    - We broke fascistfirewall in 0.1.1.5-alpha. Oops.
    - Fix segfault in unit tests in 0.1.1.5-alpha. Oops.
    - Fix bug with tor_memmem finding a match at the end of the string.
    - Make unit tests run without segfaulting.
    - Resolve some solaris x86 compile warnings.
    - Handle duplicate lines in approved-routers files without warning.
    - Fix bug where as soon as a server refused any requests due to his
      exit policy (e.g. when we ask for localhost and he tells us that's
      127.0.0.1 and he won't do it), we decided he wasn't obeying his
      exit policy using him for any exits.
    - Only do openssl hardware accelerator stuff if openssl version is
      at least 0.9.7.

  o New controller features/fixes:
    - Add a "RESETCONF" command so you can set config options like
      AllowUnverifiedNodes and LongLivedPorts to "". Also, if you give
      a config option in the torrc with no value, then it clears it
      entirely (rather than setting it to its default).
    - Add a "GETINFO config-file" to tell us where torrc is.
    - Avoid sending blank lines when GETINFO replies should be empty.
    - Add a QUIT command for the controller (for using it manually).
    - Fix a bug in SAVECONF that was adding default dirservers and
      other redundant entries to the torrc file.

  o Start on the new directory design:
    - Generate, publish, cache, serve new network-status format.
    - Publish individual descriptors (by fingerprint, by "all", and by
      "tell me yours").
    - Publish client and server recommended versions separately.
    - Allow tor_gzip_uncompress() to handle multiple concatenated
      compressed strings. Serve compressed groups of router
      descriptors. The compression logic here could be more
      memory-efficient.
    - Distinguish v1 authorities (all currently trusted directories)
      from v2 authorities (all trusted directories).
    - Change DirServers config line to note which dirs are v1 authorities.
    - Add configuration option "V1AuthoritativeDirectory 1" which
      moria1, moria2, and tor26 should set.
    - Remove option when getting directory cache to see whether they
      support running-routers; they all do now. Replace it with one
      to see whether caches support v2 stuff.

  o New features:
    - Dirservers now do their own external reachability testing of each
      Tor server, and only list them as running if they've been found to
      be reachable. We also send back warnings to the server's logs if
      it uploads a descriptor that we already believe is unreachable.
    - Implement exit enclaves: if we know an IP address for the
      destination, and there's a running Tor server at that address
      which allows exit to the destination, then extend the circuit to
      that exit first. This provides end-to-end encryption and end-to-end
      authentication. Also, if the user wants a .exit address or enclave,
      use 4 hops rather than 3, and cannibalize a general circ for it
      if you can.
    - Permit transitioning from ORPort=0 to ORPort!=0, and back, from the
      controller. Also, rotate dns and cpu workers if the controller
      changes options that will affect them; and initialize the dns
      worker cache tree whether or not we start out as a server.
    - Only upload a new server descriptor when options change, 18
      hours have passed, uptime is reset, or bandwidth changes a lot.
    - Check [X-]Forwarded-For headers in HTTP requests when generating
      log messages. This lets people run dirservers (and caches) behind
      Apache but still know which IP addresses are causing warnings.

  o Config option changes:
    - Replace (Fascist)Firewall* config options with a new
      ReachableAddresses option that understands address policies.
      For example, "ReachableAddresses *:80,*:443"
    - Get rid of IgnoreVersion undocumented config option, and make us
      only warn, never exit, when we're running an obsolete version.
    - Make MonthlyAccountingStart config option truly obsolete now.

  o Fixes on 0.1.0.x:
    - Reject ports 465 and 587 in the default exit policy, since
      people have started using them for spam too.
    - It turns out we couldn't bootstrap a network since we added
      reachability detection in 0.1.0.1-rc. Good thing the Tor network
      has never gone down. Add an AssumeReachable config option to let
      servers and dirservers bootstrap. When we're trying to build a
      high-uptime or high-bandwidth circuit but there aren't enough
      suitable servers, try being less picky rather than simply failing.
    - Our logic to decide if the OR we connected to was the right guy
      was brittle and maybe open to a mitm for unverified routers.
    - We weren't cannibalizing circuits correctly for
      CIRCUIT_PURPOSE_C_ESTABLISH_REND and
      CIRCUIT_PURPOSE_S_ESTABLISH_INTRO, so we were being forced to
      build those from scratch. This should make hidden services faster.
    - Predict required circuits better, with an eye toward making hidden
      services faster on the service end.
    - Retry streams if the exit node sends back a 'misc' failure. This
      should result in fewer random failures. Also, after failing
      from resolve failed or misc, reset the num failures, so we give
      it a fair shake next time we try.
    - Clean up the rendezvous warn log msgs, and downgrade some to info.
    - Reduce severity on logs about dns worker spawning and culling.
    - When we're shutting down and we do something like try to post a
      server descriptor or rendezvous descriptor, don't complain that
      we seem to be unreachable. Of course we are, we're shutting down.
    - Add TTLs to RESOLVED, CONNECTED, and END_REASON_EXITPOLICY cells.
      We don't use them yet, but maybe one day our DNS resolver will be
      able to discover them.
    - Make ContactInfo mandatory for authoritative directory servers.
    - Require server descriptors to list IPv4 addresses -- hostnames
      are no longer allowed. This also fixes some potential security
      problems with people providing hostnames as their address and then
      preferentially resolving them to partition users.
    - Change log line for unreachability to explicitly suggest /etc/hosts
      as the culprit. Also make it clearer what IP address and ports we're
      testing for reachability.
    - Put quotes around user-supplied strings when logging so users are
      more likely to realize if they add bad characters (like quotes)
      to the torrc.
    - Let auth dir servers start without specifying an Address config
      option.
    - Make unit tests (and other invocations that aren't the real Tor)
      run without launching listeners, creating subdirectories, and so on.


Changes in version 0.1.1.5-alpha - 2005-08-08
  o Bugfixes included in 0.1.0.14.

  o Bugfixes on 0.1.0.x:
    - If you write "HiddenServicePort 6667 127.0.0.1 6668" in your
      torrc rather than "HiddenServicePort 6667 127.0.0.1:6668",
      it would silently using ignore the 6668.


Changes in version 0.1.0.14 - 2005-08-08
  o Bugfixes on 0.1.0.x:
      - Fix the other half of the bug with crypto handshakes
        (CVE-2005-2643).
      - Fix an assert trigger if you send a 'signal term' via the
        controller when it's listening for 'event info' messages.


Changes in version 0.1.1.4-alpha - 2005-08-04
  o Bugfixes included in 0.1.0.13.

  o Features:
    - Improve tor_gettimeofday() granularity on windows.
    - Make clients regenerate their keys when their IP address changes.
    - Implement some more GETINFO goodness: expose helper nodes, config
      options, getinfo keys.


Changes in version 0.1.0.13 - 2005-08-04
  o Bugfixes on 0.1.0.x:
    - Fix a critical bug in the security of our crypto handshakes.
    - Fix a size_t underflow in smartlist_join_strings2() that made
      it do bad things when you hand it an empty smartlist.
    - Fix Windows installer to ship Tor license (thanks to Aphex for
      pointing out this oversight) and put a link to the doc directory
      in the start menu.
    - Explicitly set no-unaligned-access for sparc: it turns out the
      new gcc's let you compile broken code, but that doesn't make it
      not-broken.


Changes in version 0.1.1.3-alpha - 2005-07-23
  o Bugfixes on 0.1.1.2-alpha:
    - Fix a bug in handling the controller's "post descriptor"
      function.
    - Fix several bugs in handling the controller's "extend circuit"
      function.
    - Fix a bug in handling the controller's "stream status" event.
    - Fix an assert failure if we have a controller listening for
      circuit events and we go offline.
    - Re-allow hidden service descriptors to publish 0 intro points.
    - Fix a crash when generating your hidden service descriptor if
      you don't have enough intro points already.

  o New features on 0.1.1.2-alpha:
    - New controller function "getinfo accounting", to ask how
      many bytes we've used in this time period.
    - Experimental support for helper nodes: a lot of the risk from
      a small static adversary comes because users pick new random
      nodes every time they rebuild a circuit. Now users will try to
      stick to the same small set of entry nodes if they can. Not
      enabled by default yet.

  o Bugfixes on 0.1.0.12:
    - If you're an auth dir server, always publish your dirport,
      even if you haven't yet found yourself to be reachable.
    - Fix a size_t underflow in smartlist_join_strings2() that made
      it do bad things when you hand it an empty smartlist.


Changes in version 0.1.0.12 - 2005-07-18
  o New directory servers:
      - tor26 has changed IP address.

  o Bugfixes on 0.1.0.x:
    - Fix a possible double-free in tor_gzip_uncompress().
    - When --disable-threads is set, do not search for or link against
      pthreads libraries.
    - Don't trigger an assert if an authoritative directory server
      claims its dirport is 0.
    - Fix bug with removing Tor as an NT service: some people were
      getting "The service did not return an error." Thanks to Matt
      Edman for the fix.


Changes in version 0.1.1.2-alpha - 2005-07-15
  o New directory servers:
    - tor26 has changed IP address.

  o Bugfixes on 0.1.0.x, crashes/leaks:
    - Port the servers-not-obeying-their-exit-policies fix from
      0.1.0.11.
    - Fix an fd leak in start_daemon().
    - On Windows, you can't always reopen a port right after you've
      closed it. So change retry_listeners() to only close and re-open
      ports that have changed.
    - Fix a possible double-free in tor_gzip_uncompress().

  o Bugfixes on 0.1.0.x, usability:
    - When tor_socketpair() fails in Windows, give a reasonable
      Windows-style errno back.
    - Let people type "tor --install" as well as "tor -install" when
      they
      want to make it an NT service.
    - NT service patch from Matt Edman to improve error messages.
    - When the controller asks for a config option with an abbreviated
      name, give the full name in our response.
    - Correct the man page entry on TrackHostExitsExpire.
    - Looks like we were never delivering deflated (i.e. compressed)
      running-routers lists, even when asked. Oops.
    - When --disable-threads is set, do not search for or link against
      pthreads libraries.

  o Bugfixes on 0.1.1.x:
    - Fix a seg fault with autodetecting which controller version is
      being used.

  o Features:
    - New hidden service descriptor format: put a version in it, and
      let people specify introduction/rendezvous points that aren't
      in "the directory" (which is subjective anyway).
    - Allow the DEBUG controller event to work again. Mark certain log
      entries as "don't tell this to controllers", so we avoid cycles.


Changes in version 0.1.0.11 - 2005-06-30
  o Bugfixes on 0.1.0.x:
    - Fix major security bug: servers were disregarding their
      exit policies if clients behaved unexpectedly.
    - Make OS X init script check for missing argument, so we don't
      confuse users who invoke it incorrectly.
    - Fix a seg fault in "tor --hash-password foo".
    - The MAPADDRESS control command was broken.


Changes in version 0.1.1.1-alpha - 2005-06-29
  o Bugfixes:
    - Make OS X init script check for missing argument, so we don't
      confuse users who invoke it incorrectly.
    - Fix a seg fault in "tor --hash-password foo".
    - Fix a possible way to DoS dirservers.
    - When we complain that your exit policy implicitly allows local or
      private address spaces, name them explicitly so operators can
      fix it.
    - Make the log message less scary when all the dirservers are
      temporarily unreachable.
    - We were printing the number of idle dns workers incorrectly when
      culling them.

  o Features:
    - Revised controller protocol (version 1) that uses ascii rather
      than binary. Add supporting libraries in python and java so you
      can use the controller from your applications without caring how
      our protocol works.
    - Spiffy new support for crypto hardware accelerators. Can somebody
      test this?


Changes in version 0.0.9.10 - 2005-06-16
  o Bugfixes on 0.0.9.x (backported from 0.1.0.10):
    - Refuse relay cells that claim to have a length larger than the
      maximum allowed. This prevents a potential attack that could read
      arbitrary memory (e.g. keys) from an exit server's process
      (CVE-2005-2050).


Changes in version 0.1.0.10 - 2005-06-14
  o Allow a few EINVALs from libevent before dying. Warn on kqueue with
    libevent before 1.1a.


Changes in version 0.1.0.9-rc - 2005-06-09
  o Bugfixes:
    - Reset buf->highwater every time buf_shrink() is called, not just on
      a successful shrink. This was causing significant memory bloat.
    - Fix buffer overflow when checking hashed passwords.
    - Security fix: if seeding the RNG on Win32 fails, quit.
    - Allow seeding the RNG on Win32 even when you're not running as
      Administrator.
    - Disable threading on Solaris too. Something is wonky with it,
      cpuworkers, and reentrant libs.
    - Reenable the part of the code that tries to flush as soon as an
      OR outbuf has a full TLS record available. Perhaps this will make
      OR outbufs not grow as huge except in rare cases, thus saving lots
      of CPU time plus memory.
    - Reject malformed .onion addresses rather then passing them on as
      normal web requests.
    - Adapt patch from Adam Langley: fix possible memory leak in
      tor_lookup_hostname().
    - Initialize libevent later in the startup process, so the logs are
      already established by the time we start logging libevent warns.
    - Use correct errno on win32 if libevent fails.
    - Check and warn about known-bad/slow libevent versions.
    - Pay more attention to the ClientOnly config option.
    - Have torctl.in/tor.sh.in check for location of su binary (needed
      on FreeBSD)
    - Correct/add man page entries for LongLivedPorts, ExitPolicy,
      KeepalivePeriod, ClientOnly, NoPublish, HttpProxy, HttpsProxy,
      HttpProxyAuthenticator
    - Stop warning about sigpipes in the logs. We're going to
      pretend that getting these occassionally is normal and fine.
    - Resolve OS X installer bugs: stop claiming to be 0.0.9.2 in
      certain
      installer screens; and don't put stuff into StartupItems unless
      the user asks you to.
    - Require servers that use the default dirservers to have public IP
      addresses. We have too many servers that are configured with private
      IPs and their admins never notice the log entries complaining that
      their descriptors are being rejected.
    - Add OSX uninstall instructions. An actual uninstall script will
      come later.


Changes in version 0.1.0.8-rc - 2005-05-23
  o Bugfixes:
    - It turns out that kqueue on OS X 10.3.9 was causing kernel
      panics. Disable kqueue on all OS X Tors.
    - Fix RPM: remove duplicate line accidentally added to the rpm
      spec file.
    - Disable threads on openbsd too, since its gethostaddr is not
      reentrant either.
    - Tolerate libevent 0.8 since it still works, even though it's
      ancient.
    - Enable building on Red Hat 9.0 again.
    - Allow the middle hop of the testing circuit to be running any
      version, now that most of them have the bugfix to let them connect
      to unknown servers. This will allow reachability testing to work
      even when 0.0.9.7-0.0.9.9 become obsolete.
    - Handle relay cells with rh.length too large. This prevents
      a potential attack that could read arbitrary memory (maybe even
      keys) from the exit server's process.
    - We screwed up the dirport reachability testing when we don't yet
      have a cached version of the directory. Hopefully now fixed.
    - Clean up router_load_single_router() (used by the controller),
      so it doesn't seg fault on error.
    - Fix a minor memory leak when somebody establishes an introduction
      point at your Tor server.
    - If a socks connection ends because read fails, don't warn that
      you're not sending a socks reply back.

  o Features:
    - Add HttpProxyAuthenticator config option too, that works like
      the HttpsProxyAuthenticator config option.
    - Encode hashed controller passwords in hex instead of base64,
      to make it easier to write controllers.


Changes in version 0.1.0.7-rc - 2005-05-17
  o Bugfixes:
    - Fix a bug in the OS X package installer that prevented it from
      installing on Tiger.
    - Fix a script bug in the OS X package installer that made it
      complain during installation.
    - Find libevent even if it's hiding in /usr/local/ and your
      CFLAGS and LDFLAGS don't tell you to look there.
    - Be able to link with libevent as a shared library (the default
      after 1.0d), even if it's hiding in /usr/local/lib and even
      if you haven't added /usr/local/lib to your /etc/ld.so.conf,
      assuming you're running gcc. Otherwise fail and give a useful
      error message.
    - Fix a bug in the RPM packager: set home directory for _tor to
      something more reasonable when first installing.
    - Free a minor amount of memory that is still reachable on exit.


Changes in version 0.1.0.6-rc - 2005-05-14
  o Bugfixes:
    - Implement --disable-threads configure option. Disable threads on
      netbsd by default, because it appears to have no reentrant resolver
      functions.
    - Apple's OS X 10.4.0 ships with a broken kqueue. The new libevent
      release (1.1) detects and disables kqueue if it's broken.
    - Append default exit policy before checking for implicit internal
      addresses. Now we don't log a bunch of complaints on startup
      when using the default exit policy.
    - Some people were putting "Address  " in their torrc, and they had
      a buggy resolver that resolved " " to 0.0.0.0. Oops.
    - If DataDir is ~/.tor, and that expands to /.tor, then default to
      LOCALSTATEDIR/tor instead.
    - Fix fragmented-message bug in TorControl.py.
    - Resolve a minor bug which would prevent unreachable dirports
      from getting suppressed in the published descriptor.
    - When the controller gave us a new descriptor, we weren't resolving
      it immediately, so Tor would think its address was 0.0.0.0 until
      we fetched a new directory.
    - Fix an uppercase/lowercase case error in suppressing a bogus
      libevent warning on some Linuxes.

  o Features:
    - Begin scrubbing sensitive strings from logs by default. Turn off
      the config option SafeLogging if you need to do debugging.
    - Switch to a new buffer management algorithm, which tries to avoid
      reallocing and copying quite as much. In first tests it looks like
      it uses *more* memory on average, but less cpu.
    - First cut at support for "create-fast" cells. Clients can use
      these when extending to their first hop, since the TLS already
      provides forward secrecy and authentication. Not enabled on
      clients yet.
    - When dirservers refuse a router descriptor, we now log its
      contactinfo, platform, and the poster's IP address.
    - Call tor_free_all instead of connections_free_all after forking, to
      save memory on systems that need to fork.
    - Whine at you if you're a server and you don't set your contactinfo.
    - Implement --verify-config command-line option to check if your torrc
      is valid without actually launching Tor.
    - Rewrite address "serifos.exit" to "localhost.serifos.exit"
      rather than just rejecting it.


Changes in version 0.1.0.5-rc - 2005-04-27
  o Bugfixes:
    - Stop trying to print a null pointer if an OR conn fails because
      we didn't like its cert.
  o Features:
    - Switch our internal buffers implementation to use a ring buffer,
      to hopefully improve performance for fast servers a lot.
    - Add HttpsProxyAuthenticator support (basic auth only), based
      on patch from Adam Langley.
    - Bump the default BandwidthRate from 1 MB to 2 MB, to accommodate
      the fast servers that have been joining lately.
    - Give hidden service accesses extra time on the first attempt,
      since 60 seconds is often only barely enough. This might improve
      robustness more.
    - Improve performance for dirservers: stop re-parsing the whole
      directory every time you regenerate it.
    - Add more debugging info to help us find the weird dns freebsd
      pthreads bug; cleaner debug messages to help track future issues.


Changes in version 0.0.9.9 - 2005-04-23
  o Bugfixes on 0.0.9.x:
    - If unofficial Tor clients connect and send weird TLS certs, our
      Tor server triggers an assert. This release contains a minimal
      backport from the broader fix that we put into 0.1.0.4-rc.


Changes in version 0.1.0.4-rc - 2005-04-23
  o Bugfixes:
    - If unofficial Tor clients connect and send weird TLS certs, our
      Tor server triggers an assert. Stop asserting, and start handling
      TLS errors better in other situations too.
    - When the controller asks us to tell it about all the debug-level
      logs, it turns out we were generating debug-level logs while
      telling it about them, which turns into a bad loop. Now keep
      track of whether you're sending a debug log to the controller,
      and don't log when you are.
    - Fix the "postdescriptor" feature of the controller interface: on
      non-complete success, only say "done" once.
  o Features:
    - Clients are now willing to load balance over up to 2mB, not 1mB,
      of advertised bandwidth capacity.
    - Add a NoPublish config option, so you can be a server (e.g. for
      testing running Tor servers in other Tor networks) without
      publishing your descriptor to the primary dirservers.


Changes in version 0.1.0.3-rc - 2005-04-08
  o Improvements on 0.1.0.2-rc:
    - Client now retries when streams end early for 'hibernating' or
      'resource limit' reasons, rather than failing them.
    - More automated handling for dirserver operators:
      - Automatically approve nodes running 0.1.0.2-rc or later,
        now that the the reachability detection stuff is working.
      - Now we allow two unverified servers with the same nickname
        but different keys. But if a nickname is verified, only that
        nickname+key are allowed.
      - If you're an authdirserver connecting to an address:port,
        and it's not the OR you were expecting, forget about that
        descriptor. If he *was* the one you were expecting, then forget
        about all other descriptors for that address:port.
      - Allow servers to publish descriptors from 12 hours in the future.
        Corollary: only whine about clock skew from the dirserver if
        he's a trusted dirserver (since now even verified servers could
        have quite wrong clocks).
    - Adjust maximum skew and age for rendezvous descriptors: let skew
      be 48 hours rather than 90 minutes.
    - Efficiency improvements:
      - Keep a big splay tree of (circid,orconn)->circuit mappings to make
        it much faster to look up a circuit for each relay cell.
      - Remove most calls to assert_all_pending_dns_resolves_ok(),
        since they're eating our cpu on exit nodes.
      - Stop wasting time doing a case insensitive comparison for every
        dns name every time we do any lookup. Canonicalize the names to
        lowercase and be done with it.
    - Start sending 'truncated' cells back rather than destroy cells,
      if the circuit closes in front of you. This means we won't have
      to abandon partially built circuits.
    - Only warn once per nickname from add_nickname_list_to_smartlist
      per failure, so an entrynode or exitnode choice that's down won't
      yell so much.
    - Put a note in the torrc about abuse potential with the default
      exit policy.
    - Revise control spec and implementation to allow all log messages to
      be sent to controller with their severities intact (suggested by
      Matt Edman). Update TorControl to handle new log event types.
    - Provide better explanation messages when controller's POSTDESCRIPTOR
      fails.
    - Stop putting nodename in the Platform string in server descriptors.
      It doesn't actually help, and it is confusing/upsetting some people.

  o Bugfixes on 0.1.0.2-rc:
    - We were printing the host mask wrong in exit policies in server
      descriptors. This isn't a critical bug though, since we were still
      obeying the exit policy internally.
    - Fix Tor when compiled with libevent but without pthreads: move
      connection_unregister() from _connection_free() to
      connection_free().
    - Fix an assert trigger (already fixed in 0.0.9.x): when we have
      the rare mysterious case of accepting a conn on 0.0.0.0:0, then
      when we look through the connection array, we'll find any of the
      cpu/dnsworkers. This is no good.

  o Bugfixes on 0.0.9.8:
    - Fix possible bug on threading platforms (e.g. win32) which was
      leaking a file descriptor whenever a cpuworker or dnsworker died.
    - When using preferred entry or exit nodes, ignore whether the
      circuit wants uptime or capacity. They asked for the nodes, they
      get the nodes.
    - chdir() to your datadirectory at the *end* of the daemonize process,
      not the beginning. This was a problem because the first time you
      run tor, if your datadir isn't there, and you have runasdaemon set
      to 1, it will try to chdir to it before it tries to create it. Oops.
    - Handle changed router status correctly when dirserver reloads
      fingerprint file. We used to be dropping all unverified descriptors
      right then. The bug was hidden because we would immediately
      fetch a directory from another dirserver, which would include the
      descriptors we just dropped.
    - When we're connecting to an OR and he's got a different nickname/key
      than we were expecting, only complain loudly if we're an OP or a
      dirserver. Complaining loudly to the OR admins just confuses them.
    - Tie MAX_DIR_SIZE to MAX_BUF_SIZE, so now directory sizes won't get
      artificially capped at 500kB.


Changes in version 0.0.9.8 - 2005-04-07
  o Bugfixes on 0.0.9.x:
    - We have a bug that I haven't found yet. Sometimes, very rarely,
      cpuworkers get stuck in the 'busy' state, even though the cpuworker
      thinks of itself as idle. This meant that no new circuits ever got
      established. Here's a workaround to kill any cpuworker that's been
      busy for more than 100 seconds.


Changes in version 0.1.0.2-rc - 2005-04-01
  o Bugfixes on 0.1.0.1-rc:
    - Fixes on reachability detection:
      - Don't check for reachability while hibernating.
      - If ORPort is reachable but DirPort isn't, still publish the
        descriptor, but zero out DirPort until it's found reachable.
      - When building testing circs for ORPort testing, use only
        high-bandwidth nodes, so fewer circuits fail.
      - Complain about unreachable ORPort separately from unreachable
        DirPort, so the user knows what's going on.
      - Make sure we only conclude ORPort reachability if we didn't
        initiate the conn. Otherwise we could falsely conclude that
        we're reachable just because we connected to the guy earlier
        and he used that same pipe to extend to us.
      - Authdirservers shouldn't do ORPort reachability detection,
        since they're in clique mode, so it will be rare to find a
        server not already connected to them.
      - When building testing circuits, always pick middle hops running
        Tor 0.0.9.7, so we avoid the "can't extend to unknown routers"
        bug. (This is a kludge; it will go away when 0.0.9.x becomes
        obsolete.)
      - When we decide we're reachable, actually publish our descriptor
        right then.
    - Fix bug in redirectstream in the controller.
    - Fix the state descriptor strings so logs don't claim edge streams
      are in a different state than they actually are.
    - Use recent libevent features when possible (this only really affects
      win32 and osx right now, because the new libevent with these
      features hasn't been released yet). Add code to suppress spurious
      libevent log msgs.
    - Prevent possible segfault in connection_close_unattached_ap().
    - Fix newlines on torrc in win32.
    - Improve error msgs when tor-resolve fails.

  o Improvements on 0.0.9.x:
    - New experimental script tor/contrib/ExerciseServer.py (needs more
      work) that uses the controller interface to build circuits and
      fetch pages over them. This will help us bootstrap servers that
      have lots of capacity but haven't noticed it yet.
    - New experimental script tor/contrib/PathDemo.py (needs more work)
      that uses the controller interface to let you choose whole paths
      via addresses like
      "<hostname>.<path,separated by dots>.<length of path>.path"
    - When we've connected to an OR and handshaked but didn't like
      the result, we were closing the conn without sending destroy
      cells back for pending circuits. Now send those destroys.


Changes in version 0.0.9.7 - 2005-04-01
  o Bugfixes on 0.0.9.x:
    - Fix another race crash bug (thanks to Glenn Fink for reporting).
    - Compare identity to identity, not to nickname, when extending to
      a router not already in the directory. This was preventing us from
      extending to unknown routers. Oops.
    - Make sure to create OS X Tor user in <500 range, so we aren't
      creating actual system users.
    - Note where connection-that-hasn't-sent-end was marked, and fix
      a few really loud instances of this harmless bug (it's fixed more
      in 0.1.0.x).


Changes in version 0.1.0.1-rc - 2005-03-28
  o New features:
    - Add reachability testing. Your Tor server will automatically try
      to see if its ORPort and DirPort are reachable from the outside,
      and it won't upload its descriptor until it decides they are.
    - Handle unavailable hidden services better. Handle slow or busy
      hidden services better.
    - Add support for CONNECTing through https proxies, with "HttpsProxy"
      config option.
    - New exit policy: accept most low-numbered ports, rather than
      rejecting most low-numbered ports.
    - More Tor controller support (still experimental). See
      http://tor.eff.org/doc/control-spec.txt for all the new features,
      including signals to emulate unix signals from any platform;
      redirectstream; extendcircuit; mapaddress; getinfo; postdescriptor;
      closestream; closecircuit; etc.
    - Make nt services work and start on startup on win32 (based on
      patch by Matt Edman).
    - Add a new AddressMap config directive to rewrite incoming socks
      addresses. This lets you, for example, declare an implicit
      required exit node for certain sites.
    - Add a new TrackHostExits config directive to trigger addressmaps
      for certain incoming socks addresses -- for sites that break when
      your exit keeps changing (based on patch by Mike Perry).
    - Redo the client-side dns cache so it's just an addressmap too.
    - Notice when our IP changes, and reset stats/uptime/reachability.
    - When an application is using socks5, give him the whole variety of
      potential socks5 responses (connect refused, host unreachable, etc),
      rather than just "success" or "failure".
    - A more sane version numbering system. See
      http://tor.eff.org/cvs/tor/doc/version-spec.txt for details.
    - New contributed script "exitlist": a simple python script to
      parse directories and find Tor nodes that exit to listed
      addresses/ports.
    - New contributed script "privoxy-tor-toggle" to toggle whether
      Privoxy uses Tor. Seems to be configured for Debian by default.
    - Report HTTP reasons to client when getting a response from directory
      servers -- so you can actually know what went wrong.
    - New config option MaxAdvertisedBandwidth which lets you advertise
      a low bandwidthrate (to not attract as many circuits) while still
      allowing a higher bandwidthrate in reality.

  o Robustness/stability fixes:
    - Make Tor use Niels Provos's libevent instead of its current
      poll-but-sometimes-select mess.  This will let us use faster async
      cores (like epoll, kpoll, and /dev/poll), and hopefully work better
      on Windows too.
    - pthread support now too. This was forced because when we forked,
      we ended up wasting a lot of duplicate ram over time. Also switch
      to foo_r versions of some library calls to allow reentry and
      threadsafeness.
    - Better handling for heterogeneous / unreliable nodes:
      - Annotate circuits w/ whether they aim to contain high uptime nodes
        and/or high capacity nodes. When building circuits, choose
        appropriate nodes.
      - This means that every single node in an intro rend circuit,
        not just the last one, will have a minimum uptime.
      - New config option LongLivedPorts to indicate application streams
        that will want high uptime circuits.
      - Servers reset uptime when a dir fetch entirely fails. This
        hopefully reflects stability of the server's network connectivity.
      - If somebody starts his tor server in Jan 2004 and then fixes his
        clock, don't make his published uptime be a year.
      - Reset published uptime when you wake up from hibernation.
    - Introduce a notion of 'internal' circs, which are chosen without
      regard to the exit policy of the last hop. Intro and rendezvous
      circs must be internal circs, to avoid leaking information. Resolve
      and connect streams can use internal circs if they want.
    - New circuit pooling algorithm: make sure to have enough circs around
      to satisfy any predicted ports, and also make sure to have 2 internal
      circs around if we've required internal circs lately (and with high
      uptime if we've seen that lately too).
    - Split NewCircuitPeriod option into NewCircuitPeriod (30 secs),
      which describes how often we retry making new circuits if current
      ones are dirty, and MaxCircuitDirtiness (10 mins), which describes
      how long we're willing to make use of an already-dirty circuit.
    - Cannibalize GENERAL circs to be C_REND, C_INTRO, S_INTRO, and S_REND
      circ as necessary, if there are any completed ones lying around
      when we try to launch one.
    - Make hidden services try to establish a rendezvous for 30 seconds,
      rather than for n (where n=3) attempts to build a circuit.
    - Change SHUTDOWN_WAIT_LENGTH from a fixed 30 secs to a config option
      "ShutdownWaitLength".
    - Try to be more zealous about calling connection_edge_end when
      things go bad with edge conns in connection.c.
    - Revise tor-spec to add more/better stream end reasons.
    - Revise all calls to connection_edge_end to avoid sending "misc",
      and to take errno into account where possible.

  o Bug fixes:
    - Fix a race condition that can trigger an assert, when we have a
      pending create cell and an OR connection fails right then.
    - Fix several double-mark-for-close bugs, e.g. where we were finding
      a conn for a cell even if that conn is already marked for close.
    - Make sequence of log messages when starting on win32 with no config
      file more reasonable.
    - When choosing an exit node for a new non-internal circ, don't take
      into account whether it'll be useful for any pending x.onion
      addresses -- it won't.
    - Turn addr_policy_compare from a tristate to a quadstate; this should
      help address our "Ah, you allow 1.2.3.4:80. You are a good choice
      for google.com" problem.
    - Make "platform" string in descriptor more accurate for Win32 servers,
      so it's not just "unknown platform".
    - Fix an edge case in parsing config options (thanks weasel).
      If they say "--" on the commandline, it's not an option.
    - Reject odd-looking addresses at the client (e.g. addresses that
      contain a colon), rather than having the server drop them because
      they're malformed.
    - tor-resolve requests were ignoring .exit if there was a working circuit
      they could use instead.
    - REUSEADDR on normal platforms means you can rebind to the port
      right after somebody else has let it go. But REUSEADDR on win32
      means to let you bind to the port _even when somebody else
      already has it bound_! So, don't do that on Win32.
    - Change version parsing logic: a version is "obsolete" if it is not
      recommended and (1) there is a newer recommended version in the
      same series, or (2) there are no recommended versions in the same
      series, but there are some recommended versions in a newer series.
      A version is "new" if it is newer than any recommended version in
      the same series.
    - Stop most cases of hanging up on a socks connection without sending
      the socks reject.

  o Helpful fixes:
    - Require BandwidthRate to be at least 20kB/s for servers.
    - When a dirserver causes you to give a warn, mention which dirserver
      it was.
    - New config option DirAllowPrivateAddresses for authdirservers.
      Now by default they refuse router descriptors that have non-IP or
      private-IP addresses.
    - Stop publishing socksport in the directory, since it's not
      actually meant to be public. For compatibility, publish a 0 there
      for now.
    - Change DirFetchPeriod/StatusFetchPeriod to have a special "Be
      smart" value, that is low for servers and high for clients.
    - If our clock jumps forward by 100 seconds or more, assume something
      has gone wrong with our network and abandon all not-yet-used circs.
    - Warn when exit policy implicitly allows local addresses.
    - If we get an incredibly skewed timestamp from a dirserver mirror
      that isn't a verified OR, don't warn -- it's probably him that's
      wrong.
    - Since we ship our own Privoxy on OS X, tweak it so it doesn't write
      cookies to disk and doesn't log each web request to disk. (Thanks
      to Brett Carrington for pointing this out.)
    - When a client asks us for a dir mirror and we don't have one,
      launch an attempt to get a fresh one.
    - If we're hibernating and we get a SIGINT, exit immediately.
    - Add --with-dmalloc ./configure option, to track memory leaks.
    - And try to free all memory on closing, so we can detect what
      we're leaking.
    - Cache local dns resolves correctly even when they're .exit
      addresses.
    - Give a better warning when some other server advertises an
      ORPort that is actually an apache running ssl.
    - Add "opt hibernating 1" to server descriptor to make it clearer
      whether the server is hibernating.


Changes in version 0.0.9.6 - 2005-03-24
  o Bugfixes on 0.0.9.x (crashes and asserts):
    - Add new end stream reasons to maintainance branch. Fix bug where
      reason (8) could trigger an assert.  Prevent bug from recurring.
    - Apparently win32 stat wants paths to not end with a slash.
    - Fix assert triggers in assert_cpath_layer_ok(), where we were
      blowing away the circuit that conn->cpath_layer points to, then
      checking to see if the circ is well-formed. Backport check to make
      sure we dont use the cpath on a closed connection.
    - Prevent circuit_resume_edge_reading_helper() from trying to package
      inbufs for marked-for-close streams.
    - Don't crash on hup if your options->address has become unresolvable.
    - Some systems (like OS X) sometimes accept() a connection and tell
      you the remote host is 0.0.0.0:0. If this happens, due to some
      other mis-features, we get confused; so refuse the conn for now.

  o Bugfixes on 0.0.9.x (other):
    - Fix harmless but scary "Unrecognized content encoding" warn message.
    - Add new stream error reason: TORPROTOCOL reason means "you are not
      speaking a version of Tor I understand; say bye-bye to your stream."
    - Be willing to cache directories from up to ROUTER_MAX_AGE seconds
      into the future, now that we are more tolerant of skew. This
      resolves a bug where a Tor server would refuse to cache a directory
      because all the directories it gets are too far in the future;
      yet the Tor server never logs any complaints about clock skew.
    - Mac packaging magic: make man pages useable, and do not overwrite
      existing torrc files.
    - Make OS X log happily to /var/log/tor/tor.log


Changes in version 0.0.9.5 - 2005-02-22
  o Bugfixes on 0.0.9.x:
    - Fix an assert race at exit nodes when resolve requests fail.
    - Stop picking unverified dir mirrors--it only leads to misery.
    - Patch from Matt Edman to make NT services work better. Service
      support is still not compiled into the executable by default.
    - Patch from Dmitri Bely so the Tor service runs better under
      the win32 SYSTEM account.
    - Make tor-resolve actually work (?) on Win32.
    - Fix a sign bug when getrlimit claims to have 4+ billion
      file descriptors available.
    - Stop refusing to start when bandwidthburst == bandwidthrate.
    - When create cells have been on the onion queue more than five
      seconds, just send back a destroy and take them off the list.


Changes in version 0.0.9.4 - 2005-02-03
  o Bugfixes on 0.0.9:
    - Fix an assert bug that took down most of our servers: when
      a server claims to have 1 GB of bandwidthburst, don't
      freak out.
    - Don't crash as badly if we have spawned the max allowed number
      of dnsworkers, or we're out of file descriptors.
    - Block more file-sharing ports in the default exit policy.
    - MaxConn is now automatically set to the hard limit of max
      file descriptors we're allowed (ulimit -n), minus a few for
      logs, etc.
    - Give a clearer message when servers need to raise their
      ulimit -n when they start running out of file descriptors.
    - SGI Compatibility patches from Jan Schaumann.
    - Tolerate a corrupt cached directory better.
    - When a dirserver hasn't approved your server, list which one.
    - Go into soft hibernation after 95% of the bandwidth is used,
      not 99%. This is especially important for daily hibernators who
      have a small accounting max. Hopefully it will result in fewer
      cut connections when the hard hibernation starts.
    - Load-balance better when using servers that claim more than
      800kB/s of capacity.
    - Make NT services work (experimental, only used if compiled in).


Changes in version 0.0.9.3 - 2005-01-21
  o Bugfixes on 0.0.9:
    - Backport the cpu use fixes from main branch, so busy servers won't
      need as much processor time.
    - Work better when we go offline and then come back, or when we
      run Tor at boot before the network is up. We do this by
      optimistically trying to fetch a new directory whenever an
      application request comes in and we think we're offline -- the
      human is hopefully a good measure of when the network is back.
    - Backport some minimal hidserv bugfixes: keep rend circuits open as
      long as you keep using them; actually publish hidserv descriptors
      shortly after they change, rather than waiting 20-40 minutes.
    - Enable Mac startup script by default.
    - Fix duplicate dns_cancel_pending_resolve reported by Giorgos Pallas.
    - When you update AllowUnverifiedNodes or FirewallPorts via the
      controller's setconf feature, we were always appending, never
      resetting.
    - When you update HiddenServiceDir via setconf, it was screwing up
      the order of reading the lines, making it fail.
    - Do not rewrite a cached directory back to the cache; otherwise we
      will think it is recent and not fetch a newer one on startup.
    - Workaround for webservers that lie about Content-Encoding: Tor
      now tries to autodetect compressed directories and compression
      itself. This lets us Proxypass dir fetches through apache.


Changes in version 0.0.9.2 - 2005-01-04
  o Bugfixes on 0.0.9 (crashes and asserts):
    - Fix an assert on startup when the disk is full and you're logging
      to a file.
    - If you do socks4 with an IP of 0.0.0.x but *don't* provide a socks4a
      style address, then we'd crash.
    - Fix an assert trigger when the running-routers string we get from
      a dirserver is broken.
    - Make worker threads start and run on win32. Now win32 servers
      may work better.
    - Bandaid (not actually fix, but now it doesn't crash) an assert
      where the dns worker dies mysteriously and the main Tor process
      doesn't remember anything about the address it was resolving.

  o Bugfixes on 0.0.9 (Win32):
    - Workaround for brain-damaged __FILE__ handling on MSVC: keep Nick's
      name out of the warning/assert messages.
    - Fix a superficial "unhandled error on read" bug on win32.
    - The win32 installer no longer requires a click-through for our
      license, since our Free Software license grants rights but does not
      take any away.
    - Win32: When connecting to a dirserver fails, try another one
      immediately. (This was already working for non-win32 Tors.)
    - Stop trying to parse $HOME on win32 when hunting for default
      DataDirectory.
    - Make tor-resolve.c work on win32 by calling network_init().

  o Bugfixes on 0.0.9 (other):
    - Make 0.0.9.x build on Solaris again.
    - Due to a fencepost error, we were blowing away the \n when reporting
      confvalue items in the controller. So asking for multiple config
      values at once couldn't work.
    - When listing circuits that are pending on an opening OR connection,
      if we're an OR we were listing circuits that *end* at us as
      being pending on every listener, dns/cpu worker, etc. Stop that.
    - Dirservers were failing to create 'running-routers' or 'directory'
      strings if we had more than some threshold of routers. Fix them so
      they can handle any number of routers.
    - Fix a superficial "Duplicate mark for close" bug.
    - Stop checking for clock skew for OR connections, even for servers.
    - Fix a fencepost error that was chopping off the last letter of any
      nickname that is the maximum allowed nickname length.
    - Update URLs in log messages so they point to the new website.
    - Fix a potential problem in mangling server private keys while
      writing to disk (not triggered yet, as far as we know).
    - Include the licenses for other free software we include in Tor,
      now that we're shipping binary distributions more regularly.


Changes in version 0.0.9.1 - 2004-12-15
  o Bugfixes on 0.0.9:
    - Make hibernation actually work.
    - Make HashedControlPassword config option work.
    - When we're reporting event circuit status to a controller,
      don't use the stream status code.


Changes in version 0.0.9 - 2004-12-12
  o Cleanups:
    - Clean up manpage and torrc.sample file.
    - Clean up severities and text of log warnings.
  o Mistakes:
    - Make servers trigger an assert when they enter hibernation.


Changes in version 0.0.9rc7 - 2004-12-08
  o Bugfixes on 0.0.9rc:
    - Fix a stack-trashing crash when an exit node begins hibernating.
    - Avoid looking at unallocated memory while considering which
      ports we need to build circuits to cover.
    - Stop a sigpipe: when an 'end' cell races with eof from the app,
      we shouldn't hold-open-until-flush if the eof arrived first.
    - Fix a bug with init_cookie_authentication() in the controller.
    - When recommending new-format log lines, if the upper bound is
      LOG_ERR, leave it implicit.

  o Bugfixes on 0.0.8.1:
    - Fix a whole slew of memory leaks.
    - Fix isspace() and friends so they still make Solaris happy
      but also so they don't trigger asserts on win32.
    - Fix parse_iso_time on platforms without strptime (eg win32).
    - win32: tolerate extra "readable" events better.
    - win32: when being multithreaded, leave parent fdarray open.
    - Make unit tests work on win32.


Changes in version 0.0.9rc6 - 2004-12-06
  o Bugfixes on 0.0.9pre:
    - Clean up some more integer underflow opportunities (not exploitable
      we think).
    - While hibernating, hup should not regrow our listeners.
    - Send an end to the streams we close when we hibernate, rather
      than just chopping them off.
    - React to eof immediately on non-open edge connections.

  o Bugfixes on 0.0.8.1:
    - Calculate timeout for waiting for a connected cell from the time
      we sent the begin cell, not from the time the stream started. If
      it took a long time to establish the circuit, we would time out
      right after sending the begin cell.
    - Fix router_compare_addr_to_addr_policy: it was not treating a port
      of * as always matching, so we were picking reject *:* nodes as
      exit nodes too. Oops.

  o Features:
    - New circuit building strategy: keep a list of ports that we've
      used in the past 6 hours, and always try to have 2 circuits open
      or on the way that will handle each such port. Seed us with port
      80 so web users won't complain that Tor is "slow to start up".
    - Make kill -USR1 dump more useful stats about circuits.
    - When warning about retrying or giving up, print the address, so
      the user knows which one it's talking about.
    - If you haven't used a clean circuit in an hour, throw it away,
      just to be on the safe side. (This means after 6 hours a totally
      unused Tor client will have no circuits open.)


Changes in version 0.0.9rc5 - 2004-12-01
  o Bugfixes on 0.0.8.1:
    - Disallow NDEBUG. We don't ever want anybody to turn off debug.
    - Let resolve conns retry/expire also, rather than sticking around
      forever.
    - If we are using select, make sure we stay within FD_SETSIZE.

  o Bugfixes on 0.0.9pre:
    - Fix integer underflow in tor_vsnprintf() that may be exploitable,
      but doesn't seem to be currently; thanks to Ilja van Sprundel for
      finding it.
    - If anybody set DirFetchPostPeriod, give them StatusFetchPeriod
      instead.  Impose minima and maxima for all *Period options; impose
      even tighter maxima for fetching if we are a caching dirserver.
      Clip rather than rejecting.
    - Fetch cached running-routers from servers that serve it (that is,
      authdirservers and servers running 0.0.9rc5-cvs or later.)

  o Features:
    - Accept *:706 (silc) in default exit policy.
    - Implement new versioning format for post 0.1.
    - Support "foo.nickname.exit" addresses, to let Alice request the
      address "foo" as viewed by exit node "nickname". Based on a patch
      by Geoff Goodell.
    - Make tor --version --version dump the cvs Id of every file.


Changes in version 0.0.9rc4 - 2004-11-28
  o Bugfixes on 0.0.8.1:
    - Make windows sockets actually non-blocking (oops), and handle
      win32 socket errors better.

  o Bugfixes on 0.0.9rc1:
    - Actually catch the -USR2 signal.


Changes in version 0.0.9rc3 - 2004-11-25
  o Bugfixes on 0.0.8.1:
    - Flush the log file descriptor after we print "Tor opening log file",
      so we don't see those messages days later.

  o Bugfixes on 0.0.9rc1:
    - Make tor-resolve work again.
    - Avoid infinite loop in tor-resolve if tor hangs up on it.
    - Fix an assert trigger for clients/servers handling resolves.


Changes in version 0.0.9rc2 - 2004-11-24
  o Bugfixes on 0.0.9rc1:
    - I broke socks5 support while fixing the eof bug.
    - Allow unitless bandwidths and intervals; they default to bytes
      and seconds.
    - New servers don't start out hibernating; they are active until
      they run out of bytes, so they have a better estimate of how
      long it takes, and so their operators can know they're working.


Changes in version 0.0.9rc1 - 2004-11-23
  o Bugfixes on 0.0.8.1:
    - Finally fix a bug that's been plaguing us for a year:
      With high load, circuit package window was reaching 0. Whenever
      we got a circuit-level sendme, we were reading a lot on each
      socket, but only writing out a bit. So we would eventually reach
      eof. This would be noticed and acted on even when there were still
      bytes sitting in the inbuf.
    - When poll() is interrupted, we shouldn't believe the revents values.

  o Bugfixes on 0.0.9pre6:
    - Fix hibernate bug that caused pre6 to be broken.
    - Don't keep rephist info for routers that haven't had activity for
      24 hours. (This matters now that clients have keys, since we track
      them too.)
    - Never call close_temp_logs while validating log options.
    - Fix backslash-escaping on tor.sh.in and torctl.in.

  o Features:
    - Implement weekly/monthly/daily accounting: now you specify your
      hibernation properties by
      AccountingMax N bytes|KB|MB|GB|TB
      AccountingStart day|week|month [day] HH:MM
        Defaults to "month 1 0:00".
    - Let bandwidth and interval config options be specified as 5 bytes,
      kb, kilobytes, etc; and as seconds, minutes, hours, days, weeks.
    - kill -USR2 now moves all logs to loglevel debug (kill -HUP to
      get back to normal.)
    - If your requested entry or exit node has advertised bandwidth 0,
      pick it anyway.
    - Be more greedy about filling up relay cells -- we try reading again
      once we've processed the stuff we read, in case enough has arrived
      to fill the last cell completely.
    - Apply NT service patch from Osamu Fujino. Still needs more work.


Changes in version 0.0.9pre6 - 2004-11-15
  o Bugfixes on 0.0.8.1:
    - Fix assert failure on malformed socks4a requests.
    - Use identity comparison, not nickname comparison, to choose which
      half of circuit-ID-space each side gets to use. This is needed
      because sometimes we think of a router as a nickname, and sometimes
      as a hex ID, and we can't predict what the other side will do.
    - Catch and ignore SIGXFSZ signals when log files exceed 2GB; our
      write() call will fail and we handle it there.
    - Add a FAST_SMARTLIST define to optionally inline smartlist_get
      and smartlist_len, which are two major profiling offenders.

  o Bugfixes on 0.0.9pre5:
    - Fix a bug in read_all that was corrupting config files on windows.
    - When we're raising the max number of open file descriptors to
      'unlimited', don't log that we just raised it to '-1'.
    - Include event code with events, as required by control-spec.txt.
    - Don't give a fingerprint when clients do --list-fingerprint:
      it's misleading, because it will never be the same again.
    - Stop using strlcpy in tor_strndup, since it was slowing us
      down a lot.
    - Remove warn on startup about missing cached-directory file.
    - Make kill -USR1 work again.
    - Hibernate if we start tor during the "wait for wakeup-time" phase
      of an accounting interval. Log our hibernation plans better.
    - Authoritative dirservers now also cache their directory, so they
      have it on start-up.

  o Features:
    - Fetch running-routers; cache running-routers; compress
      running-routers; serve compressed running-routers.z
    - Add NSI installer script contributed by J Doe.
    - Commit VC6 and VC7 workspace/project files.
    - Commit a tor.spec for making RPM files, with help from jbash.
    - Add contrib/torctl.in contributed by Glenn Fink.
    - Implement the control-spec's SAVECONF command, to write your
      configuration to torrc.
    - Get cookie authentication for the controller closer to working.
    - Include control-spec.txt in the tarball.
    - When set_conf changes our server descriptor, upload a new copy.
      But don't upload it too often if there are frequent changes.
    - Document authentication config in man page, and document signals
      we catch.
    - Clean up confusing parts of man page and torrc.sample.
    - Make expand_filename handle ~ and ~username.
    - Use autoconf to enable largefile support where necessary. Use
      ftello where available, since ftell can fail at 2GB.
    - Distinguish between TOR_TLS_CLOSE and TOR_TLS_ERROR, so we can
      log more informatively.
    - Give a slightly more useful output for "tor -h".
    - Refuse application socks connections to port 0.
    - Check clock skew for verified servers, but allow unverified
      servers and clients to have any clock skew.
    - Break DirFetchPostPeriod into:
      - DirFetchPeriod for fetching full directory,
      - StatusFetchPeriod for fetching running-routers,
      - DirPostPeriod for posting server descriptor,
      - RendPostPeriod for posting hidden service descriptors.
    - Make sure the hidden service descriptors are at a random offset
      from each other, to hinder linkability.


Changes in version 0.0.9pre5 - 2004-11-09
  o Bugfixes on 0.0.9pre4:
    - Fix a seg fault in unit tests (doesn't affect main program).
    - Fix an assert bug where a hidden service provider would fail if
      the first hop of his rendezvous circuit was down.
    - Hidden service operators now correctly handle version 1 style
      INTRODUCE1 cells (nobody generates them still, so not a critical
      bug).
    - If do_hup fails, actually notice.
    - Handle more errnos from accept() without closing the listener.
      Some OpenBSD machines were closing their listeners because
      they ran out of file descriptors.
    - Send resolve cells to exit routers that are running a new
      enough version of the resolve code to work right.
    - Better handling of winsock includes on non-MSV win32 compilers.
    - Some people had wrapped their tor client/server in a script
      that would restart it whenever it died. This did not play well
      with our "shut down if your version is obsolete" code. Now people
      don't fetch a new directory if their local cached version is
      recent enough.
    - Make our autogen.sh work on ksh as well as bash.

  o Major Features:
    - Hibernation: New config option "AccountingMaxKB" lets you
      set how many KBytes per month you want to allow your server to
      consume. Rather than spreading those bytes out evenly over the
      month, we instead hibernate for some of the month and pop up
      at a deterministic time, work until the bytes are consumed, then
      hibernate again. Config option "MonthlyAccountingStart" lets you
      specify which day of the month your billing cycle starts on.
    - Control interface: a separate program can now talk to your
      client/server over a socket, and get/set config options, receive
      notifications of circuits and streams starting/finishing/dying,
      bandwidth used, etc. The next step is to get some GUIs working.
      Let us know if you want to help out. See doc/control-spec.txt .
    - Ship a contrib/tor-control.py as an example script to interact
      with the control port.
    - "tor --hash-password zzyxz" will output a salted password for
      use in authenticating to the control interface.
    - New log format in config:
      "Log minsev[-maxsev] stdout|stderr|syslog" or
      "Log minsev[-maxsev] file /var/foo"

  o Minor Features:
    - DirPolicy config option, to let people reject incoming addresses
      from their dirserver.
    - "tor --list-fingerprint" will list your identity key fingerprint
      and then exit.
    - Add "pass" target for RedirectExit, to make it easier to break
      out of a sequence of RedirectExit rules.
    - Clients now generate a TLS cert too, in preparation for having
      them act more like real nodes.
    - Ship src/win32/ in the tarball, so people can use it to build.
    - Make old win32 fall back to CWD if SHGetSpecialFolderLocation
      is broken.
    - New "router-status" line in directory, to better bind each verified
      nickname to its identity key.
    - Deprecate unofficial config option abbreviations, and abbreviations
      not on the command line.
    - Add a pure-C tor-resolve implementation.
    - Use getrlimit and friends to ensure we can reach MaxConn (currently
      1024) file descriptors.

  o Code security improvements, inspired by Ilja:
    - Replace sprintf with snprintf. (I think they were all safe, but
      hey.)
    - Replace strcpy/strncpy with strlcpy in more places.
    - Avoid strcat; use snprintf or strlcat instead.
    - snprintf wrapper with consistent (though not C99) overflow behavior.


Changes in version 0.0.9pre4 - 2004-10-17
  o Bugfixes on 0.0.9pre3:
    - If the server doesn't specify an exit policy, use the real default
      exit policy, not reject *:*.
    - Ignore fascistfirewall when uploading/downloading hidden service
      descriptors, since we go through Tor for those; and when using
      an HttpProxy, since we assume it can reach them all.
    - When looking for an authoritative dirserver, use only the ones
      configured at boot. Don't bother looking in the directory.
    - The rest of the fix for get_default_conf_file() on older win32.
    - Make 'Routerfile' config option obsolete.

  o Features:
    - New 'MyFamily nick1,...' config option for a server to
      specify other servers that shouldn't be used in the same circuit
      with it. Only believed if nick1 also specifies us.
    - New 'NodeFamily nick1,nick2,...' config option for a client to
      specify nodes that it doesn't want to use in the same circuit.
    - New 'Redirectexit pattern address:port' config option for a
      server to redirect exit connections, e.g. to a local squid.


Changes in version 0.0.9pre3 - 2004-10-13
  o Bugfixes on 0.0.8.1:
    - Better torrc example lines for dirbindaddress and orbindaddress.
    - Improved bounds checking on parsed ints (e.g. config options and
      the ones we find in directories.)
    - Better handling of size_t vs int, so we're more robust on 64
      bit platforms.
    - Fix the rest of the bug where a newly started OR would appear
      as unverified even after we've added his fingerprint and hupped
      the dirserver.
    - Fix a bug from 0.0.7: when read() failed on a stream, we would
      close it without sending back an end. So 'connection refused'
      would simply be ignored and the user would get no response.

  o Bugfixes on 0.0.9pre2:
    - Serving the cached-on-disk directory to people is bad. We now
      provide no directory until we've fetched a fresh one.
    - Workaround for bug on windows where cached-directories get crlf
      corruption.
    - Make get_default_conf_file() work on older windows too.
    - If we write a *:* exit policy line in the descriptor, don't write
      any more exit policy lines.

  o Features:
    - Use only 0.0.9pre1 and later servers for resolve cells.
    - Make the dirservers file obsolete.
      - Include a dir-signing-key token in directories to tell the
        parsing entity which key is being used to sign.
      - Remove the built-in bulky default dirservers string.
      - New config option "Dirserver %s:%d [fingerprint]", which can be
        repeated as many times as needed. If no dirservers specified,
        default to moria1,moria2,tor26.
    - Make moria2 advertise a dirport of 80, so people behind firewalls
      will be able to get a directory.
    - Http proxy support
      - Dirservers translate requests for http://%s:%d/x to /x
      - You can specify "HttpProxy %s[:%d]" and all dir fetches will
        be routed through this host.
      - Clients ask for /tor/x rather than /x for new enough dirservers.
        This way we can one day coexist peacefully with apache.
      - Clients specify a "Host: %s%d" http header, to be compatible
        with more proxies, and so running squid on an exit node can work.


Changes in version 0.0.8.1 - 2004-10-13
  o Bugfixes:
    - Fix a seg fault that can be triggered remotely for Tor
      clients/servers with an open dirport.
    - Fix a rare assert trigger, where routerinfos for entries in
      our cpath would expire while we're building the path.
    - Fix a bug in OutboundBindAddress so it (hopefully) works.
    - Fix a rare seg fault for people running hidden services on
      intermittent connections.
    - Fix a bug in parsing opt keywords with objects.
    - Fix a stale pointer assert bug when a stream detaches and
      reattaches.
    - Fix a string format vulnerability (probably not exploitable)
      in reporting stats locally.
    - Fix an assert trigger: sometimes launching circuits can fail
      immediately, e.g. because too many circuits have failed recently.
    - Fix a compile warning on 64 bit platforms.


Changes in version 0.0.9pre2 - 2004-10-03
  o Bugfixes:
    - Make fetching a cached directory work for 64-bit platforms too.
    - Make zlib.h a required header, not an optional header.


Changes in version 0.0.9pre1 - 2004-10-01
  o Bugfixes:
    - Stop using separate defaults for no-config-file and
      empty-config-file. Now you have to explicitly turn off SocksPort,
      if you don't want it open.
    - Fix a bug in OutboundBindAddress so it (hopefully) works.
    - Improve man page to mention more of the 0.0.8 features.
    - Fix a rare seg fault for people running hidden services on
      intermittent connections.
    - Change our file IO stuff (especially wrt OpenSSL) so win32 is
      happier.
    - Fix more dns related bugs: send back resolve_failed and end cells
      more reliably when the resolve fails, rather than closing the
      circuit and then trying to send the cell. Also attach dummy resolve
      connections to a circuit *before* calling dns_resolve(), to fix
      a bug where cached answers would never be sent in RESOLVED cells.
    - When we run out of disk space, or other log writing error, don't
      crash. Just stop logging to that log and continue.
    - We were starting to daemonize before we opened our logs, so if
      there were any problems opening logs, we would complain to stderr,
      which wouldn't work, and then mysteriously exit.
    - Fix a rare bug where sometimes a verified OR would connect to us
      before he'd uploaded his descriptor, which would cause us to
      assign conn->nickname as though he's unverified. Now we look through
      the fingerprint list to see if he's there.
    - Fix a rare assert trigger, where routerinfos for entries in
      our cpath would expire while we're building the path.

  o Features:
    - Clients can ask dirservers for /dir.z to get a compressed version
      of the directory. Only works for servers running 0.0.9, of course.
    - Make clients cache directories and use them to seed their router
      lists at startup. This means clients have a datadir again.
    - Configuration infrastructure support for warning on obsolete
      options.
    - Respond to content-encoding headers by trying to uncompress as
      appropriate.
    - Reply with a deflated directory when a client asks for "dir.z".
      We could use allow-encodings instead, but allow-encodings isn't
      specified in HTTP 1.0.
    - Raise the max dns workers from 50 to 100.
    - Discourage people from setting their dirfetchpostperiod more often
      than once per minute.
    - Protect dirservers from overzealous descriptor uploading -- wait
      10 seconds after directory gets dirty, before regenerating.


Changes in version 0.0.8 - 2004-08-25
  o Port it to SunOS 5.9 / Athena


Changes in version 0.0.8rc2 - 2004-08-20
  o Make it compile on cygwin again.
  o When picking unverified routers, skip those with low uptime and/or
    low bandwidth, depending on what properties you care about.


Changes in version 0.0.8rc1 - 2004-08-18
  o Changes from 0.0.7.3:
    - Bugfixes:
      - Fix assert triggers: if the other side returns an address 0.0.0.0,
        don't put it into the client dns cache.
      - If a begin failed due to exit policy, but we believe the IP address
        should have been allowed, switch that router to exitpolicy reject *:*
        until we get our next directory.
    - Features:
      - Clients choose nodes proportional to advertised bandwidth.
      - Avoid using nodes with low uptime as introduction points.
      - Handle servers with dynamic IP addresses: don't replace
        options->Address with the resolved one at startup, and
        detect our address right before we make a routerinfo each time.
      - 'FascistFirewall' option to pick dirservers and ORs on specific
        ports; plus 'FirewallPorts' config option to tell FascistFirewall
        which ports are open. (Defaults to 80,443)
      - Be more aggressive about trying to make circuits when the network
        has changed (e.g. when you unsuspend your laptop).
      - Check for time skew on http headers; report date in response to
        "GET /".
      - If the entrynode config line has only one node, don't pick it as
        an exitnode.
      - Add strict{entry|exit}nodes config options. If set to 1, then
        we refuse to build circuits that don't include the specified entry
        or exit nodes.
      - OutboundBindAddress config option, to bind to a specific
        IP address for outgoing connect()s.
      - End truncated log entries (e.g. directories) with "[truncated]".

  o Patches to 0.0.8preX:
    - Bugfixes:
      - Patches to compile and run on win32 again (maybe)?
      - Fix crash when looking for ~/.torrc with no $HOME set.
      - Fix a race bug in the unit tests.
      - Handle verified/unverified name collisions better when new
        routerinfo's arrive in a directory.
      - Sometimes routers were getting entered into the stats before
        we'd assigned their identity_digest. Oops.
      - Only pick and establish intro points after we've gotten a
        directory.
    - Features:
      - AllowUnverifiedNodes config option to let circuits choose no-name
        routers in entry,middle,exit,introduction,rendezvous positions.
        Allow middle and rendezvous positions by default.
      - Add a man page for tor-resolve.


Changes in version 0.0.7.3 - 2004-08-12
  o Stop dnsworkers from triggering an assert failure when you
    ask them to resolve the host "".


Changes in version 0.0.8pre3 - 2004-08-09
  o Changes from 0.0.7.2:
    - Allow multiple ORs with same nickname in routerlist -- now when
      people give us one identity key for a nickname, then later
      another, we don't constantly complain until the first expires.
    - Remember used bandwidth (both in and out), and publish 15-minute
      snapshots for the past day into our descriptor.
    - You can now fetch $DIRURL/running-routers to get just the
      running-routers line, not the whole descriptor list. (But
      clients don't use this yet.)
    - When people mistakenly use Tor as an http proxy, point them
      at the tor-doc.html rather than the INSTALL.
    - Remove our mostly unused -- and broken -- hex_encode()
      function. Use base16_encode() instead. (Thanks to Timo Lindfors
      for pointing out this bug.)
    - Rotate onion keys every 12 hours, not every 2 hours, so we have
      fewer problems with people using the wrong key.
    - Change the default exit policy to reject the default edonkey,
      kazaa, gnutella ports.
    - Add replace_file() to util.[ch] to handle win32's rename().

  o Changes from 0.0.8preX:
    - Fix two bugs in saving onion keys to disk when rotating, so
      hopefully we'll get fewer people using old onion keys.
    - Fix an assert error that was making SocksPolicy not work.
    - Be willing to expire routers that have an open dirport -- it's
      just the authoritative dirservers we want to not forget.
    - Reject tor-resolve requests for .onion addresses early, so we
      don't build a whole rendezvous circuit and then fail.
    - When you're warning a server that he's unverified, don't cry
      wolf unpredictably.
    - Fix a race condition: don't try to extend onto a connection
      that's still handshaking.
    - For servers in clique mode, require the conn to be open before
      you'll choose it for your path.
    - Fix some cosmetic bugs about duplicate mark-for-close, lack of
      end relay cell, etc.
    - Measure bandwidth capacity over the last 24 hours, not just 12
    - Bugfix: authoritative dirservers were making and signing a new
      directory for each client, rather than reusing the cached one.


Changes in version 0.0.8pre2 - 2004-08-04
  o Changes from 0.0.7.2:
    - Security fixes:
      - Check directory signature _before_ you decide whether you're
        you're running an obsolete version and should exit.
      - Check directory signature _before_ you parse the running-routers
        list to decide who's running or verified.
    - Bugfixes and features:
      - Check return value of fclose while writing to disk, so we don't
        end up with broken files when servers run out of disk space.
      - Log a warning if the user uses an unsafe socks variant, so people
        are more likely to learn about privoxy or socat.
      - Dirservers now include RFC1123-style dates in the HTTP headers,
        which one day we will use to better detect clock skew.

  o Changes from 0.0.8pre1:
    - Make it compile without warnings again on win32.
    - Log a warning if you're running an unverified server, to let you
      know you might want to get it verified.
    - Only pick a default nickname if you plan to be a server.


Changes in version 0.0.8pre1 - 2004-07-23
  o Bugfixes:
    - Made our unit tests compile again on OpenBSD 3.5, and tor
      itself compile again on OpenBSD on a sparc64.
    - We were neglecting milliseconds when logging on win32, so
      everything appeared to happen at the beginning of each second.

  o Protocol changes:
    - 'Extend' relay cell payloads now include the digest of the
      intended next hop's identity key. Now we can verify that we're
      extending to the right router, and also extend to routers we
      hadn't heard of before.

  o Features:
    - Tor nodes can now act as relays (with an advertised ORPort)
      without being manually verified by the dirserver operators.
      - Uploaded descriptors of unverified routers are now accepted
        by the dirservers, and included in the directory.
      - Verified routers are listed by nickname in the running-routers
        list; unverified routers are listed as "$<fingerprint>".
      - We now use hash-of-identity-key in most places rather than
        nickname or addr:port, for improved security/flexibility.
      - To avoid Sybil attacks, paths still use only verified servers.
        But now we have a chance to play around with hybrid approaches.
      - Nodes track bandwidth usage to estimate capacity (not used yet).
      - ClientOnly option for nodes that never want to become servers.
    - Directory caching.
      - "AuthoritativeDir 1" option for the official dirservers.
      - Now other nodes (clients and servers) will cache the latest
        directory they've pulled down.
      - They can enable their DirPort to serve it to others.
      - Clients will pull down a directory from any node with an open
        DirPort, and check the signature/timestamp correctly.
      - Authoritative dirservers now fetch directories from other
        authdirservers, to stay better synced.
      - Running-routers list tells who's down also, along with noting
        if they're verified (listed by nickname) or unverified (listed
        by hash-of-key).
      - Allow dirservers to serve running-router list separately.
        This isn't used yet.
    - ORs connect-on-demand to other ORs
      - If you get an extend cell to an OR you're not connected to,
        connect, handshake, and forward the create cell.
      - The authoritative dirservers stay connected to everybody,
        and everybody stays connected to 0.0.7 servers, but otherwise
        clients/servers expire unused connections after 5 minutes.
    - When servers get a sigint, they delay 30 seconds (refusing new
      connections) then exit. A second sigint causes immediate exit.
    - File and name management:
      - Look for .torrc if no CONFDIR "torrc" is found.
      - If no datadir is defined, then choose, make, and secure ~/.tor
        as datadir.
      - If torrc not found, exitpolicy reject *:*.
      - Expands ~/ in filenames to $HOME/ (but doesn't yet expand ~arma).
      - If no nickname is defined, derive default from hostname.
      - Rename secret key files, e.g. identity.key -> secret_id_key,
        to discourage people from mailing their identity key to tor-ops.
    - Refuse to build a circuit before the directory has arrived --
      it won't work anyway, since you won't know the right onion keys
      to use.
    - Try other dirservers immediately if the one you try is down. This
      should tolerate down dirservers better now.
    - Parse tor version numbers so we can do an is-newer-than check
      rather than an is-in-the-list check.
    - New socks command 'resolve', to let us shim gethostbyname()
      locally.
      - A 'tor_resolve' script to access the socks resolve functionality.
      - A new socks-extensions.txt doc file to describe our
        interpretation and extensions to the socks protocols.
    - Add a ContactInfo option, which gets published in descriptor.
    - Publish OR uptime in descriptor (and thus in directory) too.
    - Write tor version at the top of each log file
    - New docs in the tarball:
      - tor-doc.html.
      - Document that you should proxy your SSL traffic too.


Changes in version 0.0.7.2 - 2004-07-07
  o A better fix for the 0.0.0.0 problem, that will hopefully
    eliminate the remaining related assertion failures.


Changes in version 0.0.7.1 - 2004-07-04
  o When an address resolves to 0.0.0.0, treat it as a failed resolve,
    since internally we use 0.0.0.0 to signify "not yet resolved".


Changes in version 0.0.7 - 2004-06-07
  o Updated the man page to reflect the new features.


Changes in version 0.0.7rc2 - 2004-06-06
  o Changes from 0.0.7rc1:
    - Make it build on Win32 again.
  o Changes from 0.0.6.2:
    - Rotate dnsworkers and cpuworkers on SIGHUP, so they get new config
      settings too.


Changes in version 0.0.7rc1 - 2004-06-02
  o Bugfixes:
    - On sighup, we were adding another log without removing the first
      one. So log messages would get duplicated n times for n sighups.
    - Several cases of using a connection after we'd freed it. The
      problem was that connections that are pending resolve are in both
      the pending_resolve tree, and also the circuit's resolving_streams
      list. When you want to remove one, you must remove it from both.
    - Fix a double-mark-for-close where an end cell arrived for a
      resolving stream, and then the resolve failed.
    - Check directory signatures based on name of signer, not on whom
      we got the directory from. This will let us cache directories more
      easily.
  o Features:
    - Crank up some of our constants to handle more users.


Changes in version 0.0.7pre1 - 2004-06-02
  o Fixes for crashes and other obnoxious bugs:
    - Fix an epipe bug: sometimes when directory connections failed
      to connect, we would give them a chance to flush before closing
      them.
    - When we detached from a circuit because of resolvefailed, we
      would immediately try the same circuit twice more, and then
      give up on the resolve thinking we'd tried three different
      exit nodes.
    - Limit the number of intro circuits we'll attempt to build for a
      hidden service per 15-minute period.
    - Check recommended-software string *early*, before actually parsing
      the directory. Thus we can detect an obsolete version and exit,
      even if the new directory format doesn't parse.
  o Fixes for security bugs:
    - Remember which nodes are dirservers when you startup, and if a
      random OR enables his dirport, don't automatically assume he's
      a trusted dirserver.
  o Other bugfixes:
    - Directory connections were asking the wrong poll socket to
      start writing, and not asking themselves to start writing.
    - When we detached from a circuit because we sent a begin but
      didn't get a connected, we would use it again the first time;
      but after that we would correctly switch to a different one.
    - Stop warning when the first onion decrypt attempt fails; they
      will sometimes legitimately fail now that we rotate keys.
    - Override unaligned-access-ok check when $host_cpu is ia64 or
      arm. Apparently they allow it but the kernel whines.
    - Dirservers try to reconnect periodically too, in case connections
      have failed.
    - Fix some memory leaks in directory servers.
    - Allow backslash in Win32 filenames.
    - Made Tor build complain-free on FreeBSD, hopefully without
      breaking other BSD builds. We'll see.
  o Features:
    - Doxygen markup on all functions and global variables.
    - Make directory functions update routerlist, not replace it. So
      now directory disagreements are not so critical a problem.
    - Remove the upper limit on number of descriptors in a dirserver's
      directory (not that we were anywhere close).
    - Allow multiple logfiles at different severity ranges.
    - Allow *BindAddress to specify ":port" rather than setting *Port
      separately. Allow multiple instances of each BindAddress config
      option, so you can bind to multiple interfaces if you want.
    - Allow multiple exit policy lines, which are processed in order.
      Now we don't need that huge line with all the commas in it.
    - Enable accept/reject policies on SOCKS connections, so you can bind
      to 0.0.0.0 but still control who can use your OP.


Changes in version 0.0.6.2 - 2004-05-16
  o Our integrity-checking digest was checking only the most recent cell,
    not the previous cells like we'd thought.
    Thanks to Stefan Mark for finding the flaw!


Changes in version 0.0.6.1 - 2004-05-06
  o Fix two bugs in our AES counter-mode implementation (this affected
    onion-level stream encryption, but not TLS-level). It turns
    out we were doing something much more akin to a 16-character
    polyalphabetic cipher. Oops.
    Thanks to Stefan Mark for finding the flaw!
  o Retire moria3 as a directory server, and add tor26 as a directory
    server.


Changes in version 0.0.6 - 2004-05-02
  [version bump only]


Changes in version 0.0.6rc4 - 2004-05-01
  o Update the built-in dirservers list to use the new directory format
  o Fix a rare seg fault: if a node offering a hidden service attempts
    to build a circuit to Alice's rendezvous point and fails before it
    reaches the last hop, it retries with a different circuit, but
    then dies.
  o Handle windows socket errors correctly.


Changes in version 0.0.6rc3 - 2004-04-28
  o Don't expire non-general excess circuits (if we had enough
    circuits open, we were expiring rendezvous circuits -- even
    when they had a stream attached. oops.)
  o Fetch randomness from /dev/urandom better (not via fopen/fread)
  o Better debugging for tls errors
  o Some versions of openssl have an SSL_pending function that erroneously
    returns bytes when there is a non-application record pending.
  o Set Content-Type on the directory and hidserv descriptor.
  o Remove IVs from cipher code, since AES-ctr has none.
  o Win32 fixes. Tor now compiles on win32 with no warnings/errors.
    o We were using an array of length zero in a few places.
    o win32's gethostbyname can't resolve an IP to an IP.
    o win32's close can't close a socket.


Changes in version 0.0.6rc2 - 2004-04-26
  o Fix a bug where we were closing tls connections intermittently.
    It turns out openssl keeps its errors around -- so if an error
    happens, and you don't ask about it, and then another openssl
    operation happens and succeeds, and you ask if there was an error,
    it tells you about the first error. Fun fun.
  o Fix a bug that's been lurking since 27 may 03 (!)
    When passing back a destroy cell, we would use the wrong circ id.
    'Mostly harmless', but still worth fixing.
  o Since we don't support truncateds much, don't bother sending them;
    just close the circ.
  o check for <machine/limits.h> so we build on NetBSD again (I hope).
  o don't crash if a conn that sent a begin has suddenly lost its circuit
    (this was quite rare).


Changes in version 0.0.6rc1 - 2004-04-25
  o We now rotate link (tls context) keys and onion keys.
  o CREATE cells now include oaep padding, so you can tell
    if you decrypted them correctly.
  o Add bandwidthburst to server descriptor.
  o Directories now say which dirserver signed them.
  o Use a tor_assert macro that logs failed assertions too.


Changes in version 0.0.6pre5 - 2004-04-18
  o changes from 0.0.6pre4:
    - make tor build on broken freebsd 5.2 installs
    - fix a failed assert when you try an intro point, get a nack, and try
      a second one and it works.
    - when alice uses a port that the hidden service doesn't accept,
      it now sends back an end cell (denied by exit policy). otherwise
      alice would just have to wait to time out.
    - fix another rare bug: when we had tried all the intro
      points for a hidden service, we fetched the descriptor
      again, but we left our introcirc thinking it had already
      sent an intro, so it kept waiting for a response...
    - bugfix: when you sleep your hidden-service laptop, as soon
      as it wakes up it tries to upload a service descriptor, but
      socketpair fails for some reason (localhost not up yet?).
      now we simply give up on that upload, and we'll try again later.
      i'd still like to find the bug though.
    - if an intro circ waiting for an ack dies before getting one, then
      count it as a nack
    - we were reusing stale service descriptors and refetching usable
      ones. oops.


Changes in version 0.0.6pre4 - 2004-04-14
  o changes from 0.0.6pre3:
    - when bob fails to connect to the rendezvous point, and his
      circ didn't fail because of the rendezvous point itself, then
      he retries a couple of times
    - we expire introduction and rendezvous circs more thoroughly
      (sometimes they were hanging around forever)
    - we expire unattached rendezvous streams that have been around
      too long (they were sticking around forever).
    - fix a measly fencepost error that was crashing everybody with
      a strict glibc.


Changes in version 0.0.6pre3 - 2004-04-14
  o changes from 0.0.6pre2:
    - make hup work again
    - fix some memory leaks for dirservers
    - allow more skew in rendezvous descriptor timestamps, to help
      handle people like blanu who don't know what time it is
    - normal circs are 3 hops, but some rend/intro circs are 4, if
      the initiator doesn't get to choose the last hop
    - send acks for introductions, so alice can know whether to try
      again
    - bob publishes intro points more correctly
  o changes from 0.0.5:
    - fix an assert trigger that's been plaguing us since the days
      of 0.0.2prexx (thanks weasel!)
    - retry stream correctly when we fail to connect because of
      exit-policy-reject (should try another) or can't-resolve-address
      (also should try another, because dns on random internet servers
      is flaky).
    - when we hup a dirserver and we've *removed* a server from the
      approved-routers list, now we remove that server from the
      in-memory directories too


Changes in version 0.0.6pre2 - 2004-04-08
  o We fixed our base32 implementation. Now it works on all architectures.


Changes in version 0.0.6pre1 - 2004-04-08
  o Features:
    - Hidden services and rendezvous points are implemented. Go to
      http://6sxoyfb3h2nvok2d.onion/ for an index of currently available
      hidden services. (This only works via a socks4a proxy such as
      Privoxy, and currently it's quite slow.)


Changes in version 0.0.5 - 2004-03-30
  [version bump only]


Changes in version 0.0.5rc3 - 2004-03-29
  o Install torrc as torrc.sample -- we no longer clobber your
    torrc. (Woo!)
  o Re-enable recommendedversion checking (we broke it in rc2, oops)
  o Add in a 'notice' log level for things the operator should hear
    but that aren't warnings


Changes in version 0.0.5rc2 - 2004-03-29
  o Hold socks connection open until reply is flushed (if possible)
  o Make exit nodes resolve IPs to IPs immediately, rather than asking
    the dns farm to do it.
  o Fix c99 aliasing warnings in rephist.c
  o Don't include server descriptors that are older than 24 hours in the
    directory.
  o Give socks 'reject' replies their whole 15s to attempt to flush,
    rather than seeing the 60s timeout and assuming the flush had failed.
  o Clean automake droppings from the cvs repository


Changes in version 0.0.5rc1 - 2004-03-28
  o Fix mangled-state bug in directory fetching (was causing sigpipes).
  o Only build circuits after we've fetched the directory: clients were
    using only the directory servers before they'd fetched a directory.
    This also means longer startup time; so it goes.
  o Fix an assert trigger where an OP would fail to handshake, and we'd
    expect it to have a nickname.
  o Work around a tsocks bug: do a socks reject when AP connection dies
    early, else tsocks goes into an infinite loop.


Changes in version 0.0.4 - 2004-03-26
  o When connecting to a dirserver or OR and the network is down,
    we would crash.


Changes in version 0.0.3 - 2004-03-26
  o Warn and fail if server chose a nickname with illegal characters
  o Port to Solaris and Sparc:
    - include missing header fcntl.h
    - have autoconf find -lsocket -lnsl automatically
    - deal with hardware word alignment
    - make uname() work (solaris has a different return convention)
    - switch from using signal() to sigaction()
  o Preliminary work on reputation system:
    - Keep statistics on success/fail of connect attempts; they're published
      by kill -USR1 currently.
    - Add a RunTesting option to try to learn link state by creating test
      circuits, even when SocksPort is off.
    - Remove unused open circuits when there are too many.


Changes in version 0.0.2 - 2004-03-19
    - Include strlcpy and strlcat for safer string ops
    - define INADDR_NONE so we compile (but still not run) on solaris


Changes in version 0.0.2pre27 - 2004-03-14
  o Bugfixes:
    - Allow internal tor networks (we were rejecting internal IPs,
      now we allow them if they're set explicitly).
    - And fix a few endian issues.


Changes in version 0.0.2pre26 - 2004-03-14
  o New features:
    - If a stream times out after 15s without a connected cell, don't
      try that circuit again: try a new one.
    - Retry streams at most 4 times. Then give up.
    - When a dirserver gets a descriptor from an unknown router, it
      logs its fingerprint (so the dirserver operator can choose to
      accept it even without mail from the server operator).
    - Inform unapproved servers when we reject their descriptors.
    - Make tor build on Windows again. It works as a client, who knows
      about as a server.
    - Clearer instructions in the torrc for how to set up a server.
    - Be more efficient about reading fd's when our global token bucket
      (used for rate limiting) becomes empty.
  o Bugfixes:
    - Stop asserting that computers always go forward in time. It's
      simply not true.
    - When we sent a cell (e.g. destroy) and then marked an OR connection
      expired, we might close it before finishing a flush if the other
      side isn't reading right then.
    - Don't allow dirservers to start if they haven't defined
      RecommendedVersions
    - We were caching transient dns failures. Oops.
    - Prevent servers from publishing an internal IP as their address.
    - Address a strcat vulnerability in circuit.c


Changes in version 0.0.2pre25 - 2004-03-04
  o New features:
    - Put the OR's IP in its router descriptor, not its fqdn. That way
      we'll stop being stalled by gethostbyname for nodes with flaky dns,
      e.g. poblano.
  o Bugfixes:
    - If the user typed in an address that didn't resolve, the server
      crashed.


Changes in version 0.0.2pre24 - 2004-03-03
  o Bugfixes:
    - Fix an assertion failure in dns.c, where we were trying to dequeue
      a pending dns resolve even if it wasn't pending
    - Fix a spurious socks5 warning about still trying to write after the
      connection is finished.
    - Hold certain marked_for_close connections open until they're finished
      flushing, rather than losing bytes by closing them too early.
    - Correctly report the reason for ending a stream
    - Remove some duplicate calls to connection_mark_for_close
    - Put switch_id and start_daemon earlier in the boot sequence, so it
      will actually try to chdir() to options.DataDirectory
    - Make 'make test' exit(1) if a test fails; fix some unit tests
    - Make tor fail when you use a config option it doesn't know about,
      rather than warn and continue.
    - Make --version work
    - Bugfixes on the rpm spec file and tor.sh, so it's more up to date


Changes in version 0.0.2pre23 - 2004-02-29
  o New features:
    - Print a statement when the first circ is finished, so the user
      knows it's working.
    - If a relay cell is unrecognized at the end of the circuit,
      send back a destroy. (So attacks to mutate cells are more
      clearly thwarted.)
    - New config option 'excludenodes' to avoid certain nodes for circuits.
    - When it daemonizes, it chdir's to the DataDirectory rather than "/",
      so you can collect coredumps there.
 o Bugfixes:
    - Fix a bug in tls flushing where sometimes data got wedged and
      didn't flush until more data got sent. Hopefully this bug was
      a big factor in the random delays we were seeing.
    - Make 'connected' cells include the resolved IP, so the client
      dns cache actually gets populated.
    - Disallow changing from ORPort=0 to ORPort>0 on hup.
    - When we time-out on a stream and detach from the circuit, send an
      end cell down it first.
    - Only warn about an unknown router (in exitnodes, entrynodes,
      excludenodes) after we've fetched a directory.


Changes in version 0.0.2pre22 - 2004-02-26
  o New features:
    - Servers publish less revealing uname information in descriptors.
    - More memory tracking and assertions, to crash more usefully when
      errors happen.
    - If the default torrc isn't there, just use some default defaults.
      Plus provide an internal dirservers file if they don't have one.
    - When the user tries to use Tor as an http proxy, give them an http
      501 failure explaining that we're a socks proxy.
    - Dump a new router.desc on hup, to help confused people who change
      their exit policies and then wonder why router.desc doesn't reflect
      it.
    - Clean up the generic tor.sh init script that we ship with.
  o Bugfixes:
    - If the exit stream is pending on the resolve, and a destroy arrives,
      then the stream wasn't getting removed from the pending list. I
      think this was the one causing recent server crashes.
    - Use a more robust poll on OSX 10.3, since their poll is flaky.
    - When it couldn't resolve any dirservers, it was useless from then on.
      Now it reloads the RouterFile (or default dirservers) if it has no
      dirservers.
    - Move the 'tor' binary back to /usr/local/bin/ -- it turns out
      many users don't even *have* a /usr/local/sbin/.


Changes in version 0.0.2pre21 - 2004-02-18
  o New features:
    - There's a ChangeLog file that actually reflects the changelog.
    - There's a 'torify' wrapper script, with an accompanying
      tor-tsocks.conf, that simplifies the process of using tsocks for
      tor. It even has a man page.
    - The tor binary gets installed to sbin rather than bin now.
    - Retry streams where the connected cell hasn't arrived in 15 seconds
    - Clean up exit policy handling -- get the default out of the torrc,
      so we can update it without forcing each server operator to fix
      his/her torrc.
    - Allow imaps and pop3s in default exit policy
  o Bugfixes:
    - Prevent picking middleman nodes as the last node in the circuit


Changes in version 0.0.2pre20 - 2004-01-30
  o New features:
    - We now have a deb package, and it's in debian unstable. Go to
      it, apt-getters. :)
    - I've split the TotalBandwidth option into BandwidthRate (how many
      bytes per second you want to allow, long-term) and
      BandwidthBurst (how many bytes you will allow at once before the cap
      kicks in).  This better token bucket approach lets you, say, set
      BandwidthRate to 10KB/s and BandwidthBurst to 10MB, allowing good
      performance while not exceeding your monthly bandwidth quota.
    - Push out a tls record's worth of data once you've got it, rather
      than waiting until you've read everything waiting to be read. This
      may improve performance by pipelining better. We'll see.
    - Add an AP_CONN_STATE_CONNECTING state, to allow streams to detach
      from failed circuits (if they haven't been connected yet) and attach
      to new ones.
    - Expire old streams that haven't managed to connect. Some day we'll
      have them reattach to new circuits instead.

  o Bugfixes:
    - Fix several memory leaks that were causing servers to become bloated
      after a while.
    - Fix a few very rare assert triggers. A few more remain.
    - Setuid to User _before_ complaining about running as root.


Changes in version 0.0.2pre19 - 2004-01-07
  o Bugfixes:
    - Fix deadlock condition in dns farm. We were telling a child to die by
      closing the parent's file descriptor to him. But newer children were
      inheriting the open file descriptor from the parent, and since they
      weren't closing it, the socket never closed, so the child never read
      eof, so he never knew to exit. Similarly, dns workers were holding
      open other sockets, leading to all sorts of chaos.
    - New cleaner daemon() code for forking and backgrounding.
    - If you log to a file, it now prints an entry at the top of the
      logfile so you know it's working.
    - The onionskin challenge length was 30 bytes longer than necessary.
    - Started to patch up the spec so it's not quite so out of date.


Changes in version 0.0.2pre18 - 2004-01-02
  o Bugfixes:
    - Fix endian issues with the 'integrity' field in the relay header.
    - Fix a potential bug where connections in state
      AP_CONN_STATE_CIRCUIT_WAIT might unexpectedly ask to write.


Changes in version 0.0.2pre17 - 2003-12-30
  o Bugfixes:
    - Made --debuglogfile (or any second log file, actually) work.
    - Resolved an edge case in get_unique_circ_id_by_conn where a smart
      adversary could force us into an infinite loop.

  o Features:
    - Each onionskin handshake now includes a hash of the computed key,
      to prove the server's identity and help perfect forward secrecy.
    - Changed cell size from 256 to 512 bytes (working toward compatibility
      with MorphMix).
    - Changed cell length to 2 bytes, and moved it to the relay header.
    - Implemented end-to-end integrity checking for the payloads of
      relay cells.
    - Separated streamid from 'recognized' (otherwise circuits will get
      messed up when we try to have streams exit from the middle). We
      use the integrity-checking to confirm that a cell is addressed to
      this hop.
    - Randomize the initial circid and streamid values, so an adversary who
      breaks into a node can't learn how many circuits or streams have
      been made so far.


Changes in version 0.0.2pre16 - 2003-12-14
  o Bugfixes:
    - Fixed a bug that made HUP trigger an assert
    - Fixed a bug where a circuit that immediately failed wasn't being
      counted as a failed circuit in counting retries.

  o Features:
    - Now we close the circuit when we get a truncated cell: otherwise we're
      open to an anonymity attack where a bad node in the path truncates
      the circuit and then we open streams at him.
    - Add port ranges to exit policies
    - Add a conservative default exit policy
    - Warn if you're running tor as root
    - on HUP, retry OR connections and close/rebind listeners
    - options.EntryNodes: try these nodes first when picking the first node
    - options.ExitNodes: if your best choices happen to include any of
      your preferred exit nodes, you choose among just those preferred
      exit nodes.
    - options.ExcludedNodes: nodes that are never picked in path building


Changes in version 0.0.2pre15 - 2003-12-03
  o Robustness and bugfixes:
    - Sometimes clients would cache incorrect DNS resolves, which would
      really screw things up.
    - An OP that goes offline would slowly leak all its sockets and stop
      working.
    - A wide variety of bugfixes in exit node selection, exit policy
      handling, and processing pending streams when a new circuit is
      established.
    - Pick nodes for a path only from those the directory says are up
    - Choose randomly from all running dirservers, not always the first one
    - Increase allowed http header size for directory fetch.
    - Stop writing to stderr (if we're daemonized it will be closed).
    - Enable -g always, so cores will be more useful to me.
    - Switch "-lcrypto -lssl" to "-lssl -lcrypto" for broken distributions.

  o Documentation:
    - Wrote a man page. It lists commonly used options.

  o Configuration:
    - Change default loglevel to warn.
    - Make PidFile default to null rather than littering in your CWD.
    - OnionRouter config option is now obsolete. Instead it just checks
      ORPort>0.
    - Moved to a single unified torrc file for both clients and servers.


Changes in version 0.0.2pre14 - 2003-11-29
  o Robustness and bugfixes:
    - Force the admin to make the DataDirectory himself
      - to get ownership/permissions right
      - so clients no longer make a DataDirectory and then never use it
    - fix bug where a client who was offline for 45 minutes would never
      pull down a directory again
    - fix (or at least hide really well) the dns assert bug that was
      causing server crashes
    - warnings and improved robustness wrt clockskew for certs
    - use the native daemon(3) to daemonize, when available
    - exit if bind() fails
    - exit if neither socksport nor orport is defined
    - include our own tor_timegm (Win32 doesn't have its own)
    - bugfix for win32 with lots of connections
    - fix minor bias in PRNG
    - make dirserver more robust to corrupt cached directory

  o Documentation:
    - Wrote the design document (woo)

  o Circuit building and exit policies:
    - Circuits no longer try to use nodes that the directory has told them
      are down.
    - Exit policies now support bitmasks (18.0.0.0/255.0.0.0) and
      bitcounts (18.0.0.0/8).
    - Make AP connections standby for a circuit if no suitable circuit
      exists, rather than failing
    - Circuits choose exit node based on addr/port, exit policies, and
      which AP connections are standing by
    - Bump min pathlen from 2 to 3
    - Relay end cells have a payload to describe why the stream ended.
    - If the stream failed because of exit policy, try again with a new
      circuit.
    - Clients have a dns cache to remember resolved addresses.
    - Notice more quickly when we have no working circuits

  o Configuration:
    - APPort is now called SocksPort
    - SocksBindAddress, ORBindAddress, DirBindAddress let you configure
      where to bind
    - RecommendedVersions is now a config variable rather than
      hardcoded (for dirservers)
    - Reloads config on HUP
    - Usage info on -h or --help
    - If you set User and Group config vars, it'll setu/gid to them.

Changes in version 0.0.2pre13 - 2003-10-19
  o General stability:
    - SSL_write no longer fails when it returns WANTWRITE and the number
      of bytes in the buf has changed by the next SSL_write call.
    - Fix segfault fetching directory when network is down
    - Fix a variety of minor memory leaks
    - Dirservers reload the fingerprints file on HUP, so I don't have
      to take down the network when I approve a new router
    - Default server config file has explicit Address line to specify fqdn

  o Buffers:
    - Buffers grow and shrink as needed (Cut process size from 20M to 2M)
    - Make listener connections not ever alloc bufs

  o Autoconf improvements:
    - don't clobber an external CFLAGS in ./configure
    - Make install now works
    - create var/lib/tor on make install
    - autocreate a tor.sh initscript to help distribs
    - autocreate the torrc and sample-server-torrc with correct paths

  o Log files and Daemonizing now work:
    - If --DebugLogFile is specified, log to it at -l debug
    - If --LogFile is specified, use it instead of commandline
    - If --RunAsDaemon is set, tor forks and backgrounds on startup

